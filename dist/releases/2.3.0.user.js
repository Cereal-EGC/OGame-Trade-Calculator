// ==UserScript==
// @name           OGame Trade Calculator
// @description    Adds a trade calculator to the OGame interface
// @namespace      http://userscripts.org/users/68563/scripts
// @downloadURL    https://userscripts.org/scripts/source/151002.user.js
// @updateURL      https://userscripts.org/scripts/source/151002.meta.js
// @version        2.3.0
// @include        *://*.ogame.*/game/index.php?*page=*
// ==/UserScript==
/*! OGame Trade Calculator (C) 2012 Elías Grande Cásedas | GNU-GPL | gnu.org/licenses */
(function(){var E,t={ID_PREFIX:(E="o_trade_calc_"),NAME:"OGame Trade Calculator",HOME_URL:"http://userscripts.org/scripts/show/151002",TESTED_OGAME_VERSION:"5.2.0-beta1"};var o=window,I,p;try{if(unsafeWindow){o=unsafeWindow}}catch(F){}I=o.document;p=o.jQuery;p.getScript("/cdn/js/greasemonkey/version-check.js",function(){o.oGameVersionCheck(t.NAME,t.TESTED_OGAME_VERSION,t.HOME_URL)});
/*! jCaret (C) 2010 C. F. Wong | cloudgen.w0ng.hk | www.opensource.org/licenses/mit-license.php */
(function(K,e,J,L){K.fn.caret=function(aa,W){var N,Q,Y=this[0],S=K.browser.msie;if(typeof aa==="object"&&typeof aa.start==="number"&&typeof aa.end==="number"){N=aa.start;Q=aa.end}else{if(typeof aa==="number"&&typeof W==="number"){N=aa;Q=W}else{if(typeof aa==="string"){if((N=Y.value.indexOf(aa))>-1){Q=N+aa[e]}else{N=null}}else{if(Object.prototype.toString.call(aa)==="[object RegExp]"){var X=aa.exec(Y.value);if(X!=null){N=X.index;Q=N+X[0][e]}}}}}if(typeof N!="undefined"){if(S){var T=this[0].createTextRange();T.collapse(true);T.moveStart("character",N);T.moveEnd("character",Q-N);T.select()}else{this[0].selectionStart=N;this[0].selectionEnd=Q}this[0].focus();return this}else{if(S){var V=document.selection;if(this[0].tagName.toLowerCase()!="textarea"){var O=this.val(),R=V[J]()[L]();R.moveEnd("character",O[e]);var Z=(R.text==""?O[e]:O.lastIndexOf(R.text));R=V[J]()[L]();R.moveStart("character",-O[e]);var U=R.text[e]}else{var R=V[J](),M=R[L]();M.moveToElementText(this[0]);M.setEndPoint("EndToEnd",R);var Z=M.text[e]-R.text[e],U=Z+R.text[e]}}else{var Z=Y.selectionStart,U=Y.selectionEnd}var P=Y.value.substring(Z,U);return{start:Z,end:U,text:P,replace:function(ab){return Y.value.substring(0,Z)+ab+Y.value.substring(U,Y.value[e])}}}}})(p,"length","createRange","duplicate");
/*! [/jCaret] */
String.prototype.replaceAll=function(e,J){return this.split(e).join(J)};String.prototype.recursiveReplaceMap=function(M,L,J){if(J==0){return this.split(M[0]).join(L[0])}var K,e=this.split(M[J]);for(K in e){e[K]=e[K].recursiveReplaceMap(M,L,J-1)}return e.join(L[J])};String.prototype.replaceMap=function(e){var J,M,L,K;M=new Array();L=new Array();K=0;for(J in e){M.push(J);L.push(e[J]);K++}if(K==0){return this}else{return this.recursiveReplaceMap(M,L,K-1)}};String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")};var i=({getMeta:function(J,K){try{return p('meta[name="'+J+'"]').attr("content")}catch(L){if(arguments.length>1){return K}else{return null}}},getResource:function(K){var e={NAME:"",AMOUNT:0,getName:function(M){var L=this.NAME+"";i[M]=this.AMOUNT+0;return L}};var J=p("#"+K).attr("title");e.NAME=J.split(":").shift();e.AMOUNT=parseInt(J.split("/tr").shift().replace(/\D/g,""));return e},init:function(){return{LANGUAGE:this.getMeta("ogame-language",""),RES_MET:this.getResource("metal_box"),RES_CRY:this.getResource("crystal_box"),RES_DEU:this.getResource("deuterium_box")}}}).init();var q={
/*! [colors] */
MET:"#FF7700",CRY:"#00FFFF",DEU:"#FF33FF"
/*! [/colors] */
};var r=({text:{RES_MET:i.RES_MET.getName("RES_MET"),RES_CRY:i.RES_CRY.getName("RES_CRY"),RES_DEU:i.RES_DEU.getName("RES_DEU")},set:function(e,J){if(e.test(i.LANGUAGE)){p.extend(true,this.text,J)}return this}}
/*! [i18n=en] */
).set(/.*/,{THO_SEP:",",DEC_SEP:".",MENU:"Trace C.",TITLE:"Trade calculator",ACTION:"Action",BUY:"I buy",SELL:"I sell",RATIO:"Ratio",ILLEGAL:"illegal",IN_EXCH:"In exchange for",RESULT:"Result",MESSAGE:"Message",WHERE:"Place of delivery",PLANET:"Planet",MOON:"Moon",CUR_PLA:"Current planet",SEL_CUR:"Select current planet or moon",MAX:"Maximum",REG:"Regular",MIN:"Minimum",RAT_LST:"Ratio list",NAME:"Name",LEGAL:"Legal",YES:"Yes",NO:"No",DEFAULT:"Default",NEW:"New",DEF_VAL:"Default values",ABB_KEY:"Abbreviations and auto-complete keys",USE_ABB:"Use abbreviations when possible",UNABB:"Unabbreviate fields when the mouse is over them",ABB_MIL:"Abbreviation for millions",ABB_THO:"Abbreviation for thousands",KEY_MIL:"Key to write millions (6 zeros)",KEY_THO:"Key to write thousands (3 zeros)",MES_TPL:"Message template",RES_DTP:"Restore default template",IE_CONF:"Import / Export configuration",IMPORT:"Import",EXPORT:"Export",ACCEPT:"Accept",CANCEL:"Cancel",RES_DEF:"Restore default settings"}
/*! [i18n=es] */
).set(/es|ar|mx/,{THO_SEP:".",DEC_SEP:",",MENU:"C. Comercio",TITLE:"Calculadora de comercio",ACTION:"Acción",BUY:"Compro",SELL:"Vendo",RATIO:"Ratio",ILLEGAL:"ilegal",IN_EXCH:"A cambio de",RESULT:"Resultado",MESSAGE:"Mensaje",WHERE:"Lugar de entrega",PLANET:"Planeta",MOON:"Luna",CUR_PLA:"Planeta actual",SEL_CUR:"Seleccionar planeta o luna actual",MAX:"Máximo",REG:"Normal",MIN:"Mínimo",RAT_LST:"Lista de ratios",NAME:"Nombre",LEGAL:"Legal",YES:"Si",NO:"No",DEFAULT:"Por defecto",NEW:"Nuevo",DEF_VAL:"Valores por defecto",ABB_KEY:"Abreviaciones y teclas de autocompletado",USE_ABB:"Usar abreviaciones cuando sea posible",UNABB:"Desabreviar campos al poner el ratón encima",ABB_MIL:"Abreviación para millones",ABB_THO:"Abreviación para miles",KEY_MIL:"Tecla para escribir millones (6 ceros)",KEY_THO:"Tecla para escribir miles (3 ceros)",MES_TPL:"Plantilla de mensaje",RES_DTP:"Restaurar plantilla por defecto",IE_CONF:"Importar / Exportar configuración",IMPORT:"Importar",EXPORT:"Exportar",ACCEPT:"Aceptar",CANCEL:"Cancelar",RES_DEF:"Restaurar ajustes por defecto"}
/*! [/i18n] */
).text;var g={
/*! [css] */
CSS:"#"+E+"window{float:left;position:relative;width:670px;overflow:visible;z-index:2;}#galaxy #"+E+"window{top:-44px;}#"+E+'header{height:28px;position: relative;background: url("http://gf1.geo.gfsrv.net/cdn63/10e31cd5234445e4084558ea3506ea.gif") no-repeat scroll 0px 0px transparent;}#'+E+"header h4{height:28px;line-height:28px;text-align:center;color:#6F9FC8;font-size:12px;font-weight:bold;position:absolute;top:0;left:100px;right:100px;}#"+E+"config_but{display:block;height:16px;width:16px;background:url(http://gf3.geo.gfsrv.net/cdne7/1f57d944fff38ee51d49c027f574ef.gif);float:right;margin:8px 0 0 0;opacity:0.5;}#"+E+"config_but:hover{opacity:1;}#"+E+'window.config input[type="button"]{margin:0 5px 0 5px;}#'+E+"window.config #"+E+"config_but{display:none;}#"+E+"config,#"+E+"window.config #"+E+"calc{display:none;}#"+E+"window.config #"+E+"config{display:block;}#"+E+'main{padding:15px 25px 0 25px;background: url("http://gf1.geo.gfsrv.net/cdn9e/4f73643e86a952be4aed7fdd61805a.gif") repeat-y scroll 5px 0px transparent;}#'+E+"main *{font-size:11px;}#"+E+"window table{width:620px;background-color:#0D1014;border-collapse:collapse;clear:both;}#"+E+"window.config table{width:598px;}#"+E+"main th{color:#6F9FC8;text-align:center;font-weight:bold;}."+E+"label,."+E+"label *{color:grey;text-align:left;}."+E+"label{padding:0 5px 0 5px;font-weight:bold;}#"+E+"window.config ."+E+"label{text-align:center;}#"+E+"main tr,#"+E+"main td,#"+E+"main th{height:28px;line-height:28px;}#"+E+'main input[type="text"]{width:100px;text-align:center;}option.'+E+"highlight{color:lime !important;font-weight:bold;}option."+E+"moon{color:orange;}."+E+"select{width:150px;text-align:left;}."+E+"select select{width:130px;text-align:center;}#"+E+"main option{padding:1px 5px 1px 5px;}."+E+"input{width:112px;padding:0 1px 0 1px;text-align:right;}."+E+"name{width:142px;padding:0 1px 0 1px;text-align:right;}#"+E+"main ."+E+"name input{width:130px;text-align:center;}."+E+"ratio{width:82px;padding:0 1px 0 1px;text-align:right;}#"+E+"main ."+E+"ratio input{width:70px;text-align:center;}#"+E+"ratio_illegal{color:red;}."+E+"output{width:108px;text-align:center;font-weight:bold;}#"+E+"output_met{color:"+q.MET+";}#"+E+"output_cry{color:"+q.CRY+";}#"+E+"output_deu{color:"+q.DEU+";}."+E+"textarea{padding:0 3px 0 3px !important;}#"+E+"message{width:601px;height:50px !important;margin:0 !important;}#"+E+"planet{width:auto;text-align:left;margin:0;}."+E+"select1row select{width:auto;text-align:left;margin:0;}#"+E+'footer{height:17px;background: url("http://gf1.geo.gfsrv.net/cdn30/aa3e8edec0a2681915b3c9c6795e6f.gif") no-repeat scroll 2px 0px transparent;}.'+E+'config_title{font-size:11px;font-weight:bold;color:#6F9FC8;line-height:22px;background:url("http://gf1.geo.gfsrv.net/cdn0b/d55059f8c9bab5ebf9e8a3563f26d1.gif") no-repeat scroll 0 0 #13181D;height:22px;margin:0 0 10px 0;padding:0 0 0 40px;border:1px solid #000;overflow:hidden;cursor:pointer;}.'+E+"config_title:hover{color:#A7AFB7;background-color:#23282D;border-color:#13181D;}."+E+"config_box{border:1px solid #000;margin:5px 5px 10px 5px;padding:5px;}#"+E+"new_ratio input{border-color:#9C0;}."+E+"check,."+E+"name_noedit{text-align:center;}."+E+"check input{vertical-align:text-bottom;}."+E+'check input[type="checkbox"]{vertical-align:middle;}.'+E+"action{text-align:center;padding:0 3px 0 3px;}."+E+'action a{background:url("http://gf1.geo.gfsrv.net/cdn94/297ee218d94064df0a66bd41a04d28.png") scroll 0 0 no-repeat;width:16px;height:16px;display:inline-block;vertical-align:top;position:relative;top:5px;border:1px solid #000;border-radius:2px;opacity:0.7;}a.'+E+"icon_up,a."+E+"icon_down,a."+E+"icon_add{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAwCAMAAAAvgQplAAAAAXNSR0IArs4c6QAAAvpQTFRFbomeXHaLb4mdgpyveJaxdpSweZKk////W3qXVnKNRWB6AAAANTU1PT09MUJTJzVD/6gAzAAA/9IA/wAAqsrjvtjrna25PlVsTWiCqbjESGF6YHyaOk9ldZOwTWeCPj4+PlRsVHeYRGKBUXCRQVx6VnibTGmFVnmbRWOERWSEXn+chJusPVhzU3SVQ19+TGyKU3aXPVRrTGqHkrHKPVZwUW6KQ2GAU3aZO09lcJCqYHqORV95UW6LTGeBQFlySGB5SmF6Q2B+VnmaUG2JVnSQS2qHSmeCL0RaXHmUU3WVoLzSqcTYQ2GCPFZxPVZxkaa1RWSDPFZyRl96XH2ZTGqGS2qJO1Ru1d7lV3SROk5kQVp0QVpz5erua4OWqLnGpcDUWn2ewMzVlK/EqLbCcY+qj6zESmF3r7zHob3TTGaAlqi2haO9XniNQ115TWiD8vX4k7DGZ4mqyNTdSmaBpcHWcImdjaKynbrRdY6hvMnTSWeHYXyaq7jDV3SQ6+/zo7/Ur8rd8PP1javGhaK82uLmq8bZq7vHh6a+0NrgnLjOhJqqUG+QpL/VsL7JdJOuXnmSytTcj6OxT2qE+Pn7eZm0zCszfZmxhqXBdZGpXHaOS2uKboynr73J4ebrhKO7obLAmLfR+vv9nLfNip+uX3yYXn+bdoyec42gobC9pbS/yNPbYX2aPVRtt8XPmLTLbo2odI2geI2fVHKT2OHo3OLoRGGBRmODkK7HaImkaomka4unjaCw/f7/mbjRXnyXd4+jf5Wmp8HWjq3IiqnEeZOqPlVtVHeXYH2ai6CxYYCbZIKfZn+TTGeDVnWQb5GtVnWRSWWASmWATGuKc5CpusXOU3GQlLPMXHqXUnSUZoSifJq0fJu3ZHyT/v//dpOwqcXZYHqSYnuQ7fDz7PD0XHyYWnaRkKW1TGiFTGmEj6zDYXuPPFdzPVdzrsndhpytVHaYh52uXn6c8PP2jqzFQFt5jKvFcYqeQl99gZ+52uHmRGKAyNTcV3iaqsbZDVW+rgAAAAF0Uk5TAEDm2GYAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3AsJFTcNV6u1fQAAAE9JREFUKM/dkjEOACAIA6tL//9jFaORqhtxsBO9CS4AyQXSKwkEpAfkIMgttNh4AUtCALQ/9NGPu4A87/erj/6DD30HBZuPwztsPmIFqY8CjdEFo21taJsAAAAASUVORK5CYII=);}a."+E+"icon_down{background-position:0px -16px}a."+E+"icon_add{background-position:0px -32px}."+E+"action a:hover{opacity:1;border-color:#08090b;}."+E+"action a.disabled,."+E+"action aldisabled:hover{opacity:0.1;cursor:default;}a."+E+"icon_trash{background-position:0px -304px}#"+E+"window.config .undermark,#"+E+"window.config .overmark{font-weight:bold;text-align:center;}#"+E+"window.config textarea{display:block;width:586px;margin:0 0 5px 0;}."+E+"ie_conf{text-align:center}."+E+"hidden{position:fixed;left:-10000px;}."+E+"fieldwrapper:before,."+E+'fieldwrapper:after{content:"";display:table;}.'+E+"fieldwrapper:after{clear:both;}."+E+"fieldwrapper{padding:7px 0 7px 0;}."+E+"fieldwrapper label,."+E+"thefield{color:#6F9FC8;height:22px;line-height:22px;float:left;margin:2px 0 0 0;}."+E+"fieldwrapper label{font-weight:bold;width:320px;margin:0 15px 0 0;padding:0 0 0 10px;}."+E+'thefield input[type="text"],.'+E+"thefield select{width:200px}",
/*! [tpl=action_options] */
ACTION_OPT:'<option value="sell">'+r.SELL+'</option><option value="buy">'+r.BUY+"</option>",
/*! [tpl=output_options] */
OUTPUT_OPT:'<option value="m">'+r.RES_MET+'</option><option value="c">'+r.RES_CRY+'</option><option value="d">'+r.RES_DEU+'</option><option value="mc">'+r.RES_MET+" + "+r.RES_CRY+'</option><option value="md">'+r.RES_MET+" + "+r.RES_DEU+'</option><option value="cd">'+r.RES_CRY+" + "+r.RES_DEU+"</option>",
/*! [tpl=window] */
WINDOW:'<div id="'+E+'window" class="calc"><div id="'+E+'header"><h4>'+r.TITLE+'</h4><a id="'+E+'close" href="javascript:void(0);" class="close_details close_ressources"></a><a id="'+E+'config_but" href="javascript:void(0);"></a></div><div id="'+E+'main"><div id="'+E+'calc"><table cellspacing="0" cellpadding="0"><tbody><tr><th colspan="2"></th><th>'+r.RES_MET+"</th><th>"+r.RES_CRY+"</th><th>"+r.RES_DEU+'</th></tr><tr class="alt"><td class="'+E+'label">'+r.ACTION+'</td><td class="'+E+'select"><select id="'+E+'action">{this.ACTION_OPT}</select></td><td class="'+E+'input"><input id="'+E+'input_met" type="text" value=""></td><td class="'+E+'input"><input id="'+E+'input_cry" type="text" value=""></td><td class="'+E+'input"><input id="'+E+'input_deu" type="text" value=""></td></tr><tr><td class="'+E+'label">'+r.RATIO+'<span id="'+E+'ratio_illegal"> ('+r.ILLEGAL+')</span></td><td class="'+E+'select"><select id="'+E+'ratio"></select></td><td class="'+E+'input"><input id="'+E+'ratio_met" type="text" value=""></td><td class="'+E+'input"><input id="'+E+'ratio_cry" type="text" value=""></td><td class="'+E+'input"><input id="'+E+'ratio_deu" type="text" value=""></td></tr><tr class="alt"><td class="'+E+'label">'+r.IN_EXCH+'</td><td class="'+E+'select"><select id="'+E+'output">{this.OUTPUT_OPT}</select></td><td class="'+E+'input"><input id="'+E+'percent_met" type="text" value=""></td><td class="'+E+'input"><input id="'+E+'percent_cry" type="text" value=""></td><td class="'+E+'input"><input id="'+E+'percent_deu" type="text" value=""></td></tr><tr><td class="'+E+'label" colspan="2">'+r.RESULT+'</td><td class="'+E+'output" id="'+E+'output_met"></td><td class="'+E+'output" id="'+E+'output_cry"></td><td class="'+E+'output" id="'+E+'output_deu"></td></tr><tr><td colspan="5">&nbsp;</td></tr><tr class="alt"><td class="'+E+'label" colspan="5">'+r.PLANET+'</td></tr><tr class="alt"><td class="'+E+'select1row" colspan="5"><select id="'+E+'planet"></select></td></tr><tr><td colspan="5">&nbsp;</td></tr><tr class="alt"><td class="'+E+'label" colspan="5">'+r.MESSAGE+'</td></tr><tr class="alt"><td class="'+E+'textarea" colspan="5"><textarea id="'+E+'message" cols="1" rows="1" readonly="readonly"></textarea></td></tr></tbody></table></div><div id="'+E+'config"><div class="'+E+'config_title">'+r.RAT_LST+'</div><div class="'+E+'config_box"><table cellspacing="0" cellpadding="0"><tbody id="'+E+'ratioList"><tr><th>#</th><th>'+r.NAME+"</th><th>"+r.RES_MET+"</th><th>"+r.RES_CRY+"</th><th>"+r.RES_DEU+"</th><th>"+r.ACTION+"</th><th>"+r.LEGAL+"</th><th>"+r.DEFAULT+'</th></tr></tbody></table></div><div class="'+E+'config_title">'+r.DEF_VAL+'</div><div class="'+E+"config_box "+E+'hidden"><div class="'+E+'fieldwrapper"><label>'+r.ACTION+':</label><div class="'+E+'thefield"><select id="'+E+'defAction">{this.ACTION_OPT}</select></div></div><div class="'+E+'fieldwrapper"><label>'+r.IN_EXCH+':</label><div class="'+E+'thefield"><select id="'+E+'defOutput">{this.OUTPUT_OPT}</select></div></div><div class="'+E+'fieldwrapper"><label>'+r.SEL_CUR+':</label><div class="'+E+'thefield"><input id="'+E+'selCurPla" type="checkbox" /></div></div></div><div class="'+E+'config_title">'+r.ABB_KEY+'</div><div class="'+E+"config_box "+E+'hidden"><div class="'+E+'fieldwrapper"><label>'+r.USE_ABB+':</label><div class="'+E+'thefield"><input id="'+E+'abb" type="checkbox" /></div></div><div class="'+E+'fieldwrapper"><label>'+r.UNABB+':</label><div class="'+E+'thefield"><input id="'+E+'overUnabb" type="checkbox" /></div></div><div class="'+E+'fieldwrapper"><label>'+r.ABB_MIL+':</label><div class="'+E+'thefield"><input id="'+E+'millionAbb" type="text" maxlength="10" /></div></div><div class="'+E+'fieldwrapper"><label>'+r.ABB_THO+':</label><div class="'+E+'thefield"><input id="'+E+'thousandAbb" type="text" maxlength="10" /></div></div><div class="'+E+'fieldwrapper"><label>'+r.KEY_MIL+':</label><div class="'+E+'thefield"><input id="'+E+'millionKey" type="text" maxlength="1" /></div></div><div class="'+E+'fieldwrapper"><label>'+r.KEY_THO+':</label><div class="'+E+'thefield"><input id="'+E+'thousandKey" type="text" maxlength="1" /></div></div></div><div class="'+E+'config_title">'+r.MES_TPL+'</div><div class="'+E+"config_box "+E+'hidden"><textarea id="'+E+'messageTpl"></textarea><div class="textCenter"><input id="'+E+'messageTpl_restore" type="button" value="'+r.RES_DTP+'" class="btn_blue"></div></div><div class="'+E+'config_title">'+r.IE_CONF+'</div><div class="'+E+"config_box "+E+"ie_conf "+E+'hidden"><textarea id="'+E+'ie_conf"></textarea><input id="'+E+'ie_import" type="button" value="'+r.IMPORT+'" class="btn_blue"><input id="'+E+'ie_export" type="button" value="'+r.EXPORT+'" class="btn_blue"></div><div class="textCenter"><input id="'+E+'config_accept" type="button" value="'+r.ACCEPT+'" class="btn_blue"><input id="'+E+'config_cancel" type="button" value="'+r.CANCEL+'" class="btn_blue"><input id="'+E+'config_default" type="button" value="'+r.RES_DEF+'" class="btn_blue"></div></div></div><div id="'+E+'footer"></div></div>',
/*! [tpl=button] */
MENUBUTTON:'<li><a id="'+E+'menubutton" class="menubutton" href="javascript:void(0)" accesskey="" target="_self"><span class="textlabel">'+r.MENU+"</span></a></li>",
/*! [tpl=ratio_list_limit] */
RATIO_LIST_LIMIT:'<tr><td class="'+E+"label "+E+'pos"></td><td class="'+E+'name_noedit"></td><td class="'+E+'ratio"><input class="'+E+'edit_ratio_met" type="text" /></td><td class="'+E+'ratio"><input class="'+E+'edit_ratio_cry" type="text" /></td><td class="'+E+'ratio"><input class="'+E+'edit_ratio_deu" type="text" /></td><td class="'+E+'action"><a href="javascript:void(0)" class="'+E+'icon_up"></a><a href="javascript:void(0)" class="'+E+'icon_down"></a><a href="javascript:void(0)" class="'+E+'icon_trash disabled"></a></td><td class="'+E+'label">-</td><td class="'+E+'check"><input name="'+E+'def_ratio" type="radio" /></td></tr>',
/*! [tpl=ratio_list_item] */
RATIO_LIST_ITEM:'<tr><td class="'+E+"label "+E+'pos"></td><td class="'+E+'name"><input class="'+E+'edit_ratio_name" type="text" /></td><td class="'+E+'ratio"><input class="'+E+'edit_ratio_met" type="text" /></td><td class="'+E+'ratio"><input class="'+E+'edit_ratio_cry" type="text" /></td><td class="'+E+'ratio"><input class="'+E+'edit_ratio_deu" type="text" /></td><td class="'+E+'action"><a href="javascript:void(0)" class="'+E+'icon_up"></a><a href="javascript:void(0)" class="'+E+'icon_down"></a><a href="javascript:void(0)" class="'+E+'icon_trash"></a></td><td class="'+E+'legal"></td><td class="'+E+'check"><input name="'+E+'def_ratio" type="radio" /></td></tr>',
/*! [tpl=ratio_list_new] */
RATIO_LIST_NEW:'<tr id="'+E+'new_ratio"><td class="undermark '+E+'pos"></td><td class="'+E+'name"><input class="'+E+'edit_ratio_name" type="text" /></td><td class="'+E+'ratio"><input class="'+E+'edit_ratio_met" type="text" /></td><td class="'+E+'ratio"><input class="'+E+'edit_ratio_cry" type="text" /></td><td class="'+E+'ratio"><input class="'+E+'edit_ratio_deu" type="text" /></td><td class="'+E+'action"><a href="javascript:void(0)" class="'+E+'icon_add"></a></td><td class="'+E+'legal"></td><td class="'+E+'label">-</td></tr>',
/*! [/tpl] */
init:function(){for(var J in this){if(typeof(this[J])=="string"){for(var e in this){if(typeof(this[e])=="string"){this[J]=this[J].replaceAll("{this."+e+"}",this[e])}}}}}};var z=(function(){var e=p('meta[name="ogame-universe"]').attr("content");
/*! [default_ratios] */
return/^\w+\.ogame\.org$/.test(e)?[3,2,1,2,1,1,3,2,1]:[5,3,1,2,1.5,1,3,2,1];
/*! [/default_ratios] */
})();var w=function(){return(new Date()).getTime()};var a=function(){};var s=function(J){J.preventDefault()};var G={DEFAULT_DATA:{
/*! [config=default] */
defAction:"sell",ratioList:[{id:"MAX",ratio:[z[0],z[1],z[2]]},{id:"MIN",ratio:[z[3],z[4],z[5]]},{id:"REG",ratio:[z[6],z[7],z[8]]}],defRatio:"REG",defOutput:"m",millionAbb:"M",millionKey:"m",thousandAbb:"K",thousandKey:"k",abb:false,overUnabb:false,selCurPla:false,messageTpl:"[b]{?b}{I18N.BUY}{/b}{?s}{I18N.SELL}{/s}:[/b] {?m}[b][color={COLOR.MET}]{m}[/color][/b] ({I18N.RES_MET}){?cd} + {/cd}{/m}{?c}[b][color={COLOR.CRY}]{c}[/color][/b] ({I18N.RES_CRY}){?d} + {/d}{/c}{?d}[b][color={COLOR.DEU}]{d}[/color][/b] ({I18N.RES_DEU}){/d}\n[b]{I18N.IN_EXCH}:[/b] {?M}[b][color={COLOR.MET}]{M}[/color][/b] ({I18N.RES_MET}){?CD} + {/CD}{/M}{?C}[b][color={COLOR.CRY}]{C}[/color][/b] ({I18N.RES_CRY}){?D} + {/D}{/C}{?D}[b][color={COLOR.DEU}]{D}[/color][/b] ({I18N.RES_DEU}){/D}\n\n[b]* {I18N.RATIO}:[/b] {rm}:{rc}:{rd}{?w}\n[b]* {I18N.WHERE}:[/b] {wg}:{ws}:{wp} ({wt}){/w}\n\n[b][url={SCRIPT.HOME_URL}]{SCRIPT.NAME}[/url][/b]"
/*! [/config] */
},abbRE:/^\S+$/,keyRE:/^\S$/,_error:function(e){throw"DataError: "+e},_errorUndefined:function(e){this._error(e+" is undefined")},_errorExpected:function(J,K,L,M){var O,N=L+"";if(/^[\<\>]\d+$/.test(N)){if(N.charAt(0)==">"){O="greater"}else{O="less"}O+=" than "+N.slice(1)}else{O='"'+N.split(":").join(" or ")+'"'}this._error(J+": "+K+" "+O+' expected but "'+M+'" found')},_errorType:function(e,J,K){if(K=="undefined"){this._errorUndefined(e)}else{this._errorExpected(e,"type",J,K)}},_errorValue:function(e,J,K){this._errorExpected(e,"value",J,K)},_errorValueRE:function(e,J,K){this._error(e+': value "'+K+'" doesn\'t match the expected RegExp "'+J+'"')},_errorLength:function(e,J,K){this._errorExpected(e,"length",J,K)},parseData:function(J){var K,e,S,L=this,M=(typeof(J)=="string")?JSON.parse(J):J,T="boolean",R="string",N="number";if((S=typeof(M.defAction))!=R){L._errorType("defAction",R,S)}if(typeof(M.ratioList)=="undefined"){L._errorUndefined("ratioList")}if(!(/^sell|buy$/.test(M.defAction))){L._errorValue("defAction","sell:buy",M.defAction)}S=typeof(M.defRatio);if(!(/^number|string$/.test(S))){L._errorType("defRatio",R+":"+N,S)}var O=true,P=true,Q=true;for(K=0;K<M.ratioList.length;K++){e=M.ratioList[K];if((S=e.ratio.length)!=3){L._errorLength("ratioList["+K+"]",3,S)}if((e.ratio[0]+=0)<=0){L._errorValue("ratioList["+K+"].ratio[0]",">0",e.ratio[0])}if((e.ratio[1]+=0)<=0){L._errorValue("ratioList["+K+"].ratio[1]",">0",e.ratio[1])}if((e.ratio[2]+=0)<=0){L._errorValue("ratioList["+K+"].ratio[2]",">0",e.ratio[2])}if(e.id==M.defRatio){Q=false}if(/^MAX|MIN|REG$/.test(e.id+"")){if(e.id=="MAX"){O=false}else{if(e.id=="MIN"){P=false}}}else{if((S=typeof(e.id))!=N){L._errorType("ratioList["+K+"].id",N,S)}if((S=typeof(e.name))!=R){L._errorType("ratioList["+K+"].name",R,S)}}}if(O){L._error('ratioList: maximum ratio (id="MAX") not found')}if(P){L._error('ratioList: minimum ratio (id="MIN") not found')}if(Q){L._error('ratioList: default ratio (id="'+M.defRatio+'" == defRatio) not found')}e=M.ratioList.slice(0).sort();for(K=1;K<e.length;K++){if(e[K-1].id==e[K].id){L._error('ratioList: duplicate id "'+e[K].id+'" found')}}if(!(/^m|c|d|mc|md|cd$/.test(M.defOutput))){L._errorValue("defOutput","m:c:d:mc:md:cd",M.defOutput)}if((S=typeof(M.millionAbb))!=R){L._errorType("millionAbb",R,S)}if((S=M.millionAbb.length)<1){L._errorLength("millionAbb",">0",S)}if(!L.abbRE.test(S=M.millionAbb)){L._errorValueRE("millionAbb",L.abbRE,S)}if((S=typeof(M.millionKey))!=R){L._errorType("millionKey",R,S)}if((S=M.millionKey.length)!=1){L._errorLength("millionKey",1,S)}if(!L.keyRE.test(S=M.millionKey)){L._errorValueRE("millionKey",L.keyRE,S)}if((S=typeof(M.thousandAbb))!=R){L._errorType("thousandAbb",R,S)}if((S=M.thousandAbb.length)<1){L._errorLength("thousandAbb",">0",S)}if(!L.abbRE.test(S=M.thousandAbb)){L._errorValueRE("thousandAbb",L.abbRE,S)}if((S=typeof(M.thousandKey))!=R){L._errorType("thousandKey",R,S)}if((S=M.thousandKey.length)!=1){L._errorLength("thousandKey",1,S)}if(!L.keyRE.test(S=M.thousandKey)){L._errorValueRE("thousandKey",L.keyRE,S)}if((S=typeof(M.abb))!=T){L._errorType("abb",T,S)}if((S=typeof(M.overUnabb))!=T){L._errorType("overUnabb",T,S)}if((S=typeof(M.selCurPla))!=T){L._errorType("selCurPla",T,S)}if((S=typeof(M.messageTpl))!=R){L._errorType("messageTpl",R,S)}return M},getRatio:function(J,M){var L=(arguments.length>1)?M.ratioList[J]:this.data.ratioList[J],N=L.id+"",e,K=L.ratio.slice(0);if("name" in L){e=L.name+""}else{e=r[N]}return{id:N,ratio:K,name:e,val:N+":"+K[0]+":"+K[1]+":"+K[2],met:K[0],cry:K[1],deu:K[2]}},getRatioById:function(M,K){var e,L=(arguments.length>1)?K:this.data,J=L.ratioList;for(e in J){if(J[e].id==M){return this.getRatio(e,L)}}return null},save:function(e){if(arguments.length>0){this.data=e}o.localStorage.setItem(E+"config",JSON.stringify(this.data));return this},load:function(){var e=o.localStorage.getItem(E+"config");if(e==null){this.data=this.DEFAULT_DATA}else{this.data=p.extend({},this.DEFAULT_DATA,JSON.parse(e))}return this},remove:function(){o.localStorage.removeItem(E+"config");this.data=this.DEFAULT_DATA}};var u={formatI:function(M,K){var L,e=(arguments.length>1&&K);if(e&&M==""){return""}if(typeof(M)=="string"){L=("0"+M+"").replace(new RegExp(G.data.thousandKey+"$","i"),"000").replace(new RegExp(G.data.millionKey+"$","i"),"000000").replace(/\D/g,"").replace(/^0+(\d)/,"$1")}else{L=M.toFixed()+""}var J=/(\d+)(\d{3})/;while(J.test(L)){L=L.replace(J,"$1"+r.THO_SEP+"$2")}if(!e&&G.data.abb){return L.replace(/\D000\D000$/,G.data.millionAbb).replace(/\D(\d*[1-9]+)0*\D000$/,r.DEC_SEP+"$1"+G.data.millionAbb).replace(/\D000$/,G.data.thousandAbb)}return L},formatF:function(P,N){var O,e,M,K,J=(arguments.length>1&&N);if(J&&P==""){return""}if(typeof(P)=="string"){O=("0"+P+"").replace(/[\.\,]$/,r.DEC_SEP).replace(new RegExp("[^0-9\\"+r.DEC_SEP+"]","g"),"").replace(/^0+(\d)/,"$1")}else{O=(P+"").replace(".",r.DEC_SEP)}e=O.split(r.DEC_SEP);M=e[0];K=e.length>1?r.DEC_SEP+e[1]:"";if(O[O.length-1]==r.DEC_SEP&&J){K=r.DEC_SEP}var L=/(\d+)(\d{3})/;while(L.test(M)){M=M.replace(L,"$1"+r.THO_SEP+"$2")}return M+K},parseI:function(J){var e=u.parseF(J);if(new RegExp(G.data.thousandAbb+"$","i").test(J)){e=e*1000}else{if(new RegExp(G.data.millionAbb+"$","i").test(J)){e=e*1000000}}return Math.round(e)},parseF:function(e){return parseFloat(e.replaceAll(r.THO_SEP,"").replace(r.DEC_SEP,".").replace(/[^\d\.]/g,""))}};var H=function(){if(arguments.length<1){this.setLimits()}else{if(arguments.length<2){this.setLimits(arguments[0])}else{this.setLimits(arguments[0],arguments[1])}}};H.prototype={limits:[],isLegal:function(){var K;if(arguments.length==1){K=arguments[0]}else{K=[arguments[0],arguments[1],arguments[2]]}var J=K[0]/K[1],e=0;if(J<this.limits[e++]||J>this.limits[e++]){return false}J=K[0]/K[2];if(J<this.limits[e++]||J>this.limits[e++]){return false}J=K[1]/K[2];if(J<this.limits[e++]||J>this.limits[e++]){return false}return true},setLimits:function(L,K){if(arguments.length<2){var P,O,M,N=(arguments.length>0)?L.ratioList:G.data.ratioList;for(M in N){if(N[M].id=="MAX"){P=N[M].ratio}else{if(N[M].id=="MIN"){O=N[M].ratio}}}return this.setLimits(P,O)}this.limits=[];var J=L[0]/L[1],e=K[0]/K[1];this.limits.push(Math.min(J,e));this.limits.push(Math.max(J,e));J=L[0]/L[2];e=K[0]/K[2];this.limits.push(Math.min(J,e));this.limits.push(Math.max(J,e));J=L[1]/L[2];e=K[1]/K[2];this.limits.push(Math.min(J,e));this.limits.push(Math.max(J,e));return this}};var y,v;var b=function(M,N,L,P,Q,O,J,K,e){return{met:Math.round(((M+(N/Q)*P+(L/O)*P)/100)*J),cry:Math.round((((M/P)*Q+N+(L/O)*Q)/100)*K),deu:Math.round((((M/P)*O+(N/Q)*O+L)/100)*e)}};var C={parseIf:function(O,P,e){var Q="{?"+P+"}",L="{/"+P+"}";if(e){return O.split(Q).join("").split(L).join("")}var N,M,J,K=O;while((N=K.indexOf(Q))>=0&&(M=K.indexOf(L))>=0&&N<M){K=K.split(Q);for(N=1;N<K.length;N++){J=K[N].split(L);if(J.length>1){J.shift();K[N]=L+J.shift()+J.join(L)}}K=K.join(Q).split(Q+L).join("")}return K},parseIfs:function(N,R){var M=N+"",L=N+"",T=/\{\?(\!?\w)+\}/,P,S,Q,K,J;while(T.test(M)){P=(T.exec(M)+"").replace(/\}.*$/,"").replace(/^.*\{/,"");M=M.split("{"+P+"}").join("");try{P=P.replace(/[^\w\!]/g,"");if((J=P[Q=0])=="!"){S=!R[++Q]}else{S=R[J]}K=P.length-1;S=R[P[Q]];while(Q<K){if((J=P[++Q])=="!"){S=(S||!R[++Q])}else{S=(S||R[J])}}L=this.parseIf(L,P,S)}catch(O){alert(O)}}return L},make:function(P,K,J,O,e){var M,N=/[1-9]/,L=this.parseIfs(G.data.messageTpl,{b:(P=="buy"),s:(P=="sell"),m:N.test(K.met),c:N.test(K.cry),d:N.test(K.deu),M:N.test(J.met),C:N.test(J.cry),D:N.test(J.deu),w:e.use});L=L.replaceMap({"{m}":K.met,"{c}":K.cry,"{d}":K.deu,"{M}":J.met,"{C}":J.cry,"{D}":J.deu,"{rm}":O.met,"{rc}":O.cry,"{rd}":O.deu,"{wg}":e.galaxy,"{ws}":e.system,"{wp}":e.planet,"{wt}":e.use?"{I18N."+(e.type+"").toUpperCase()+"}":0});for(M in r){L=L.replaceAll("{I18N."+M+"}",r[M])}for(M in t){L=L.replaceAll("{SCRIPT."+M+"}",t[M])}for(M in q){L=L.replaceAll("{COLOR."+M+"}",q[M])}return L}};var A=function(J,e){this.jqo=J;if(arguments.length>1){this.val(e)}};A.prototype={val:function(e){if(arguments.length<1){return this.jqo.val()}this.jqo.val(e);return this},disable:function(){this.jqo.attr("disabled","disabled").prop("disabled",true);return this},enable:function(){this.jqo.prop("disabled",false).removeAttr("disabled");return this},isDisabled:function(){return(this.jqo.attr("disabled")=="disabled")}};var x=function(J,e){this.jqo=J;if(arguments.length>1){this.val(e)}};x.prototype=p.extend({},A.prototype,{val:function(e){if(arguments.length<1){return this.isChecked()}if(e){this.check()}else{this.uncheck()}return this},check:function(){this.jqo.attr("checked","checked").prop("checked",true);return this},uncheck:function(){this.jqo.prop("checked",false).removeAttr("checked");return this},isChecked:function(){return(this.jqo.attr("checked")=="checked")}});var f=function(N,M,K,L){var O=this,e=(O.jqo=N),J;O.value=M;O.regExp=K;O.clearOnFocus=L;O.allowEmpty=true;O.onChange=a;if(arguments.length>4){if(arguments.length>5){O.allowEmpty=arguments[4];O.onChange=arguments[5]}else{if(typeof(arguments[4])=="function"){O.onChange=arguments[4]}else{O.allowEmpty=(arguments[4]&&true)}}}J=function(){var R=e.val(),P=R.length;o.console.log(O.regExp,'"'+R+'"',O.regExp.test(R));if(O.allowEmpty||P>0){if(O.regExp.test(R)){O.value=R.trim()}else{var S=e.caret(),T=P-S.start,Q=P-S.end;P=O.value.length;T=Math.max(Math.min(P-T,P),0);Q=Math.max(Math.min(P-Q,P),0);e.val(O.value);e.caret(T,Q)}O.onChange()}};e.val(M).keyup(J).change(J).blur(function(){e.val(O.value)}).focus(function(){if(O.clearOnFocus){if(O.allowEmpty){O.val("")}else{e.val("")}}})};f.prototype=p.extend({},A.prototype,{val:function(e){if(arguments.length<1){return this.value}this.jqo.val(this.value=e);return this}});var n=function(O,N,M,L){var P=this,e=(this.jqo=O),K,J=M;this.allow0=true;this.focused=false;this.onChange=a;this.clearOnFocus=L;J=M.substring(0,1).toUpperCase();if(this.typePercent=(J=="P")){J="F"}this.formatFunc=u["format"+J];this.parseFunc=u["parse"+J];if(arguments.length>4){if(arguments.length>5){this.allow0=arguments[4];this.onChange=arguments[5]}else{if(typeof(arguments[4])=="function"){this.onChange=arguments[4]}else{this.allow0=(arguments[4]&&true)}}}this.set(N);K=function(){var U=P.jqo,S=U.val(),T=U.caret(),Q=S.length,V=Q-T.start,R=Q-T.end;S=P.formatFunc(U.val(),true);Q=S.length;V=Math.max(Math.min(Q-V,Q),0);R=Math.max(Math.min(Q-R,Q),0);num=(S=="")?0:P.parseFunc(S);if(P.allow0||num>0){P.set(S,true).onChange(P)}U.caret(V,R)};e.keyup(function(Q){if(!(/^9|16$/.test(Q.which+""))){K()}}).change(K).blur(function(){P.set(P.num);P.focused=false}).focus(function(){P.focused=true;var S=p(this);if(P.clearOnFocus||P.num==0){S.val("")}else{var R=S.caret(),Q=S.val().length;S.val(P.formatFunc(P.num,true));if(R.end==Q){if(R.start==Q){R.start=(--R.end)}else{R.end--}}Q=S.val().length;S.caret(Math.min(Math.max(0,R.start),Q),Math.min(Math.max(0,R.end),Q))}}).mouseenter(function(){if(G.data.overUnabb&&!(P.typePercent||P.focused||P.clearOnFocus)){var Q=P.jqo;Q.val(P.formatFunc(P.num,true));if(Q.val()==""){Q.val(0)}}}).mouseleave(function(){if(G.data.overUnabb&&!(P.typePercent||P.focused||P.clearOnFocus)){P.jqo.val(P.txt)}})};n.prototype=p.extend({},A.prototype,{set:function(L,K){var e,J=(arguments.length>1&&K);if(typeof(L)=="string"){e=(L+"").replace(/\%$/,"");this.num=(e=="")?0:this.parseFunc(e);this.txt=this.formatFunc(this.num)+(this.typePercent?"%":"")}else{this.num=L;this.txt=(e=this.formatFunc(L))+(this.typePercent?"%":"")}this.jqo.val(J?e:this.txt);return this}});var l=function(M,K){var N=this,e=(this.jqo=M);this.onChange=K;e.change(function(){N.set().onChange()});p('<option value="">-</option>').appendTo(e);var L=p('meta[name="ogame-planet-coordinates"]').attr("content").replace(/[^0-9\:]/g,"");var J=p('meta[name="ogame-planet-type"]').attr("content").toLowerCase().trim();p.each(p("#planetList").children("div").get(),function(O,P){var Q=p(P),R=Q.find(".planet-koords");if(R.get().length==0){return}R=R.text().replace(/[^0-9\:]/g,"");option=p('<option value="planet:'+R+'">['+R+"] "+Q.find(".planet-name").text().trim()+"</option>").appendTo(e);if(R==L&&J=="planet"){option.addClass(E+"highlight").html(option.html()+" &laquo; "+r.CUR_PLA);if(G.data.selCurPla){option.attr("selected","selected")}}if(Q.find(".moonlink").get().length>0){option=p('<option value="moon:'+R+'">['+R+"] ("+r.MOON+")</option>").appendTo(e).addClass(E+"moon");if(R==L&&J=="moon"){option.addClass(E+"highlight").html(option.html()+" &laquo; "+r.CUR_PLA);if(G.data.selCurPla){option.attr("selected","selected")}}}});this.set()};l.prototype={use:false,type:0,galaxy:0,system:0,planet:0,set:function(e){var J=((arguments.length>0)?e:this.jqo.val()).split(":");if(J.length<4){this.use=false}else{this.use=true;this.type=J.shift();this.galaxy=J.shift();this.system=J.shift();this.planet=J.shift()}return this}};var B=function(L,O,M){var J,e,N=this,K;if(arguments.length<4){this.isNew=false;this.name=("name" in M)?M.name:(M.id=="MAX")?r.MAX:(M.id=="MIN")?r.MIN:r.REG;this.id=M.id;K=M.ratio}else{this.isNew=true;this.name="*"+r.NEW;K=G.getRatioById(M.defRatio,M).ratio}this.list=L;if(this.isLimit=/^MIN|MAX$/.test(this.id)){this.jqo=p(g.RATIO_LIST_LIMIT).appendTo(L.jqo);this.jqo.find("."+E+"name_noedit").text(this.name)}else{this.jqo=p(this.isNew?g.RATIO_LIST_NEW:g.RATIO_LIST_ITEM).appendTo(L.jqo);this.nameInput=this.jqo.find("."+E+"edit_ratio_name");this.nameInput.change(function(){N.name=N.nameInput.val().trim()}).keyup(function(){N.nameInput.change()}).val(this.name)}this.posLabel=this.jqo.find("."+E+"pos");this.setPos(O);e=["met","cry","deu"];for(J in e){this[e[J]+"Input"]=new n(this.jqo.find("."+E+"edit_ratio_"+e[J]),K[J],"f",true,false,function(){N.list.onChange()})}this.addButton=this.jqo.find("."+E+"icon_add").click(function(){var Q=N.list,P=new B(Q,N.pos,N.getInfo());P.disableDown().jqo.after(N.jqo);Q.list[N.pos]=P;Q.list[N.pos-1].enableDown();N.nameInput.val(N.name="*"+r.NEW);N.setPos(++N.pos)});this.upButton=this.jqo.find("."+E+"icon_up").click(function(){N.move(true)});this.upDisabled=false;this.downButton=this.jqo.find("."+E+"icon_down").click(function(){N.move(false)});this.downDisabled=false;this.trashButton=this.jqo.find("."+E+"icon_trash");if(this.isLimit){this.trashButton.addClass("disabled")}else{this.trashButton.click(function(){N.remove()})}this.radio=this.jqo.find('input[name="'+E+'def_ratio"]').click(function(){N.list.defRatio=N.id});if(L.defRatio==this.id){this.radio.click()}this.legal=this.jqo.find("."+E+"legal")};B.prototype={getInfo:function(){var J=this,e={id:J.isNew?w():J.id,ratio:[J.metInput.num,J.cryInput.num,J.deuInput.num]};if(!J.isLimit){e.name=J.name}return e},move:function(J){var K,e;if(J){if(this.upDisabled){return this}K=this.list.list[this.pos-1];this.jqo.after(K.jqo)}else{if(this.downDisabled){return this}K=this.list.list[this.pos+1];K.jqo.after(this.jqo)}e=this.pos;this.setPos(K.pos);K.setPos(e);e=K.upDisabled;if(this.upDisabled){K.disableUp()}else{K.enableUp()}if(e){this.disableUp()}else{this.enableUp()}e=K.downDisabled;if(this.downDisabled){K.disableDown()}else{K.enableDown()}if(e){this.disableDown()}else{this.enableDown()}this.list.sortList()},remove:function(){var K,e=[],L=this.list.list,J=this.list.newItem;this.jqo.remove();L.splice(this.pos,1);for(K=0;K<L.length;K++){e[K]=(L[K].setPos(K))}this.list.list=e;if(this.list.defRatio==this.id){e[0].radio.click()}if(this.downDisabled){e[e.length-1].disableDown()}if(this.upDisabled){e[0].disableUp()}J.setPos(J.pos-1)},enableUp:function(){this.upDisabled=false;this.upButton.removeClass("disabled");return this},enableDown:function(){this.downDisabled=false;this.downButton.removeClass("disabled");return this},disableUp:function(){this.upDisabled=true;this.upButton.addClass("disabled");return this},disableDown:function(){this.downDisabled=true;this.downButton.addClass("disabled");return this},setLegal:function(e){if(e){this.legal.text(r.YES).addClass("undermark").removeClass("overmark")}else{this.legal.text(r.NO).addClass("overmark").removeClass("undermark")}return this},setPos:function(e){if(e%2==0){this.jqo.addClass("alt")}else{this.jqo.removeClass("alt")}this.pos=e;this.posLabel.html(this.isNew?"+":e+1);return this}};var k={list:[],limits:[],clear:function(){for(var J in this.list){this.list[J].jqo.remove()}this.list=(this.limits=[]);try{this.newItem.jqo.remove()}catch(K){}},sortList:function(){this.list.sort(function(J,e){return J.pos-e.pos})},build:function(J){var L,M,K=(arguments.length>0)?J:G.data;this.clear();this.defRatio=K.defRatio;for(L=0;L<K.ratioList.length;L++){M=new B(this,L,K.ratioList[L]);this.list[L]=M;if(M.isLimit){this.limits[this.limits.length]=M}}var e=this.list.length;this.newItem=new B(this,e,K,true);this.list[0].disableUp();this.list[e-1].disableDown();this.onChange()},updateData:function(e){var K=(arguments.length>0)?e:G.data;K.ratioList=[];for(var J in this.list){K.ratioList[J]=this.list[J].getInfo()}K.defRatio=this.defRatio},onChangeItem:function(e){if(!e.isLimit){e.setLegal(v.isLegal(e.getInfo().ratio))}},onChange:function(){v.setLimits(this.limits[0].getInfo().ratio,this.limits[1].getInfo().ratio);for(var e=0;e<this.list.length;e++){this.onChangeItem(this.list[e])}this.onChangeItem(this.newItem)},init:function(e){this.jqo=e}};var h=function(J,N,K,e,M){var L=this;this.list=J;this.iface=M;this.pos=N;this.title=K.click(function(){L._click()});this.box=e;if(e.hasClass(E+"hidden")){this.setOpen(false)}else{this.setOpen(true)}};h.prototype={updateOpenCss:function(){this.openCss={height:this.box.height()+"px","padding-top":this.box.css("padding-top"),"padding-bottom":this.box.css("padding-bottom"),"margin-top":this.box.css("margin-top"),"margin-bottom":this.box.css("margin-bottom")};return this},closeCss:{height:0,"padding-top":0,"padding-bottom":0,"margin-top":0,"margin-bottom":0},afterOpenCss:{height:"auto"},duration:250,setOpen:function(e){if(this.isOpen=e){this.list.itemOpen=this}return this},open:function(){this.updateOpenCss().box.removeClass(E+"hidden");return this.setOpen(true)},close:function(){this.updateOpenCss().box.addClass(E+"hidden");return this.setOpen(false)},animateOpen:function(){var e=this.afterOpenCss;this.updateOpenCss().box.css(this.closeCss).removeClass(E+"hidden").animate(this.openCss,this.duration,function(){p(this).css(e)});return this.setOpen(true)},animateClose:function(){var e=this;this.updateOpenCss().box.css(this.openCss).animate(this.closeCss,this.duration,function(){p(this).addClass(E+"hidden").css(e.openCss).css(e.afterOpenCss)});return this.setOpen(false)},_click:function(){if(!this.isOpen){this.iface.clearExport();this.list.itemOpen.animateClose();this.animateOpen()}}};var D={init:function(K,L){this.jqo=K;var J,e=[];K.find("."+E+"config_title").each(function(M,N){e[M]={title:p(N)}});K.find("."+E+"config_box").each(function(M,N){e[M].box=p(N)});this.list=[];for(J=0;J<e.length;J++){this.list[J]=new h(this,J,e[J].title,e[J].box,L)}}};var j=({addCss:function(K){var J=I.createElement("style");J.setAttribute("type","text/css");if(J.styleSheet){J.styleSheet.cssText=K}else{J.appendChild(I.createTextNode(K))}var e=I.getElementsByTagName("head")[0];e.appendChild(J);return this},findIDP:function(e){return this.window.find("#"+E+e)},menuButton:null,menuButtonAction:function(){this.menuButtonAction=function(){};this.makeWindow()},makeMenuButton:function(){var e=this;this.menuButton=p(g.MENUBUTTON).appendTo(p("#menuTableTools")).find("#"+E+"menubutton").click(function(){e.menuButtonAction()});return e},window:null,ogameHide:null,isHidden:true,show:function(){this.isHidden=false;this.ogameHide.hide();this.window.show();return this},hide:function(){this.isHidden=true;this.window.hide();this.ogameHide.show();return this},toggle:function(){if(this.isHidden){return this.show()}return this.hide()},makePlanetSelect:function(){var e=this;e.planet=new l(e.findIDP("planet"),function(){e.onChange()});return e},makeActionSelect:function(){var e=this;e.actionJqo=e.findIDP("action").change(function(){e.action=p(this).val();e.onChange()}).val(e.action=G.data.defAction);return e},makeResourceInput:function(e,J){var K=this;K["input"+e.capitalize()]=new n(K.findIDP("input_"+e),J,"i",false,true,function(){K.checkOutputSelect().onChange()});return K},makeRatioSelect:function(){var e=this;this.ratioSelectJqo=e.findIDP("ratio").change(function(){var J=p(this).val().split(":");if(J.length>3){p(this).val("");e.ratioMet.set(parseFloat(J[1]));e.ratioCry.set(parseFloat(J[2]));e.ratioDeu.set(parseFloat(J[3]));e.checkRatio().onChange()}});return e.updateRatioSelect()},updateRatioSelect:function(){var J,e=this.ratioSelectJqo.html("").append(p('<option value="">-</option>'));for(J in G.data.ratioList){ratio=G.getRatio(J);e.append(p('<option value="'+ratio.val+'">'+u.formatF(ratio.met)+":"+u.formatF(ratio.cry)+":"+u.formatF(ratio.deu)+" ("+ratio.name+")</option>"))}return this},makeRatioInput:function(e,J){var K=this;K["ratio"+e.capitalize()]=new n(K.findIDP("ratio_"+e),J,"f",true,false,function(){K.checkRatio().onChange()});return K},checkRatio:function(){var e=this;if(y.isLegal(e.ratioMet.num,e.ratioCry.num,e.ratioDeu.num)){e.ratioIllegal.hide()}else{e.ratioIllegal.show()}return e},makePercentInput:function(e){var K=this,J="percent"+e.capitalize();K[J]=new n(K.findIDP("percent_"+e),0,"p",false,true,function(N){if(N.num>100){N.set(100,true)}var L="percentMet",M;if(/Met|Cry/.test(J)&&(!K.percentDeu.isDisabled())){L="percentDeu"}else{if(/Met|Deu/.test(J)&&(!K.percentCry.isDisabled())){L="percentCry"}}M=parseFloat((100-N.num).toFixed((N.num+"").split(".").pop().length));K[L].set(M);K.onChange()});return K},checkOutputSelect:function(){var P=this,N=P.outputJqo.val(),L=(P.inputMet.num>0),J=(P.inputCry.num>0),O=(P.inputDeu.num>0),M=/m/.test(N),K=/c/.test(N),e=/d/.test(N);if(!L&&!J&&O&&!M&&!K&&e){P.changeOutputSelect("mc")}else{if(!L&&J&&!O&&!M&&K&&!e){P.changeOutputSelect("md")}else{if(L&&!J&&!O&&M&&!K&&!e){P.changeOutputSelect("cd")}else{if((!L&&J&&O)||M&&((J&&K)||(O&&e))){P.changeOutputSelect("m")}else{if((L&&!J&&O)||K&&((L&&M)||(O&&e))){P.changeOutputSelect("c")}else{if((L&&J&&!O)||e&&((L&&M)||(J&&K))){P.changeOutputSelect("d")}}}}}}return P},changeOutputSelect:function(e){this.outputJqo.val(e);m=this.percentMet.disable().set(0),c=this.percentCry.disable().set(0),d=this.percentDeu.disable().set(0);if(e=="m"){m.set(100)}else{if(e=="c"){c.set(100)}else{if(e=="d"){d.set(100)}else{if(e=="mc"){m.enable().set(50);c.enable().set(50)}else{if(e=="md"){m.enable().set(50);d.enable().set(50)}else{c.enable().set(50);d.enable().set(50)}}}}}return this},makeOutputSelect:function(){var e=this;this.outputJqo=e.findIDP("output").change(function(){e.changeOutputSelect(p(this).val());e.onChange()});return e},toggleConfigCalc:function(){this.window.toggleClass("config").toggleClass("calc");return this},updateConfigData:function(e){var K=this,J=(arguments.length>0)?e:G.data;k.updateData(J);J.defAction=K.defAction.val();J.defOutput=K.defOutput.val();J.selCurPla=K.selCurPla.val();J.abb=K.abb.val();J.overUnabb=K.overUnabb.val();J.millionAbb=K.millionAbb.val();J.millionKey=K.millionKey.val();J.thousandAbb=K.thousandAbb.val();J.thousandKey=K.thousandKey.val();J.messageTpl=K.messageTpl.val();return K},updateConfigIface:function(e){var K=this,J=(arguments.length>0)?e:G.data;v.setLimits(J);k.build(J);K.defAction.val(J.defAction);K.defOutput.val(J.defOutput);K.selCurPla.val(J.selCurPla);K.abb.val(J.abb);K.overUnabb.val(J.overUnabb);K.millionAbb.val(J.millionAbb);K.millionKey.val(J.millionKey);K.thousandAbb.val(J.thousandAbb);K.thousandKey.val(J.thousandKey);K.messageTpl.val(J.messageTpl);K.ieInput.val("");return K},updateCalcIface:function(){y.setLimits();this.inputMet.set(this.inputMet.num);this.inputCry.set(this.inputCry.num);this.inputDeu.set(this.inputDeu.num);this.updateRatioSelect().checkRatio().onChange();return this},makeConfigButtons:function(){var e=this;e.findIDP("config_but").click(function(){e.toggleConfigCalc()});e.findIDP("config_accept").click(function(){e.updateConfigData();G.save();e.updateCalcIface();e.toggleConfigCalc()});e.findIDP("config_cancel").click(function(){e.updateConfigIface();e.toggleConfigCalc()});e.findIDP("config_default").click(function(){G.remove();e.updateCalcIface();e.updateConfigIface();e.toggleConfigCalc()});return e},makeImportExport:function(){var e=this;e.ieInput=e.findIDP("ie_conf").focus(function(){p(this).select()});e.findIDP("ie_import").click(function(){try{var J=G.parseData(e.ieInput.val());e.updateConfigIface(J)}catch(K){alert(K)}});e.findIDP("ie_export").click(function(){var J=p.extend({},G.data);e.updateConfigData(J);e.ieInput.val("").val(JSON.stringify(J)).select()});return e},makeAbbKey:function(){var e=this;e.abb=new x(e.findIDP("abb"));e.overUnabb=new x(e.findIDP("overUnabb"));e.millionAbb=new f(e.findIDP("millionAbb"),G.data.millionAbb,G.abbRE,true,false);e.thousandAbb=new f(e.findIDP("thousandAbb"),G.data.thousandAbb,G.abbRE,true,false);e.millionKey=new f(e.findIDP("millionKey"),G.data.millionKey,G.keyRE,true,false);e.thousandKey=new f(e.findIDP("thousandKey"),G.data.thousandKey,G.keyRE,true,false);return e},makeMessageTpl:function(){var e=this;e.messageTpl=e.findIDP("messageTpl");e.findIDP("messageTpl_restore").click(function(){e.messageTpl.val(G.DEFAULT_DATA.messageTpl)});return e},clearExport:function(){this.ieInput.val("");return this},makeWindow:function(){g.init();G.load();y=new H();v=new H();var J=this,e=G.getRatioById(G.data.defRatio);J.ogameHide=p("#inhalt").after(this.window=p(g.WINDOW).hide());J.addCss(g.CSS).show();J.ratioIllegal=J.findIDP("ratio_illegal").hide();J.outputMessage=J.findIDP("message").click(function(){p(this).select()});J.outputMet=J.findIDP("output_met").text(0);J.outputCry=J.findIDP("output_cry").text(0);J.outputDeu=J.findIDP("output_deu").text(0);J.findIDP("close").click(function(){J.hide()});J.makeActionSelect().makeResourceInput("met",0).makeResourceInput("cry",0).makeResourceInput("deu",0).makeRatioSelect().makeRatioInput("met",e.met).makeRatioInput("cry",e.cry).makeRatioInput("deu",e.deu).makeOutputSelect().makePercentInput("met").makePercentInput("cry").makePercentInput("deu").changeOutputSelect(G.data.defOutput).makePlanetSelect().checkRatio();J.menuButtonAction=function(){J.toggle()};J.makeImportExport();D.init(J.findIDP("config"),J);k.init(J.findIDP("ratioList"),this);J.defAction=J.findIDP("defAction");J.defOutput=J.findIDP("defOutput");J.selCurPla=new x(J.findIDP("selCurPla"));J.makeAbbKey().makeMessageTpl().makeConfigButtons().updateConfigIface();return J},onChange:function(){var J=this,e=b(J.inputMet.num,J.inputCry.num,J.inputDeu.num,J.ratioMet.num,J.ratioCry.num,J.ratioDeu.num,J.percentMet.num,J.percentCry.num,J.percentDeu.num);J.outputMet.text(u.formatI(e.met));J.outputCry.text(u.formatI(e.cry));J.outputDeu.text(u.formatI(e.deu));J.outputMessage.text(C.make(J.action,{met:J.inputMet.txt,cry:J.inputCry.txt,deu:J.inputDeu.txt,},{met:J.outputMet.text(),cry:J.outputCry.text(),deu:J.outputDeu.text(),},{met:J.ratioMet.txt,cry:J.ratioCry.txt,deu:J.ratioDeu.txt,},J.planet));return J},init:function(){return this.makeMenuButton()}}).init()})();
