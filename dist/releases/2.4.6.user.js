// ==UserScript==
// @name           OGame Trade Calculator
// @description    Adds a trade calculator to the OGame interface
// @namespace      http://userscripts.org/users/68563/scripts
// @downloadURL    https://userscripts.org/scripts/source/151002.user.js
// @updateURL      https://userscripts.org/scripts/source/151002.meta.js
// @version        2.4.6
// @include        *://*.ogame.*/game/index.php?*page=*
// ==/UserScript==
/*! OGame Trade Calculator (C) 2012 Elías Grande Cásedas | GNU-GPL | gnu.org/licenses */
(function(){var G,v={ID_PREFIX:(G="o_trade_calc_"),NAME:"OGame Trade Calculator",HOME_URL:"http://userscripts.org/scripts/show/151002",TESTED_OGAME_VERSION:"5.2.0-beta4",VERSION:[2,4,6]},r=function(R,Q,M){var O,N=R.length,e=Q.length,P=Math.min(N,e);for(O=0;O<P;O++){if(R[O]>Q[O]){return false}else{if(R[O]<Q[O]){return true}}}if(N>e){return false}if(N<e){return true}if(arguments.length>2&&M){return true}return false};var p=window,L,q;try{if(unsafeWindow){p=unsafeWindow}}catch(H){}L=p.document;q=p.jQuery;var I={obj:p.localStorage,set:function(M,e){return this.obj.setItem(G+M,JSON.stringify(e))},get:function(e){return JSON.parse(this.obj.getItem(G+e))},remove:function(e){return this.obj.removeItem(G+e)}};q.getScript("/cdn/js/greasemonkey/version-check.js",function(){p.oGameVersionCheck(v.NAME,v.TESTED_OGAME_VERSION,v.HOME_URL)});
/*! jCaret (C) 2010 C. F. Wong | cloudgen.w0ng.hk | www.opensource.org/licenses/mit-license.php */
(function(N,e,M,O){N.fn.caret=function(ad,Z){var Q,T,ab=this[0],V=N.browser.msie;if(typeof ad==="object"&&typeof ad.start==="number"&&typeof ad.end==="number"){Q=ad.start;T=ad.end}else{if(typeof ad==="number"&&typeof Z==="number"){Q=ad;T=Z}else{if(typeof ad==="string"){if((Q=ab.value.indexOf(ad))>-1){T=Q+ad[e]}else{Q=null}}else{if(Object.prototype.toString.call(ad)==="[object RegExp]"){var aa=ad.exec(ab.value);if(aa!=null){Q=aa.index;T=Q+aa[0][e]}}}}}if(typeof Q!="undefined"){if(V){var W=this[0].createTextRange();W.collapse(true);W.moveStart("character",Q);W.moveEnd("character",T-Q);W.select()}else{this[0].selectionStart=Q;this[0].selectionEnd=T}this[0].focus();return this}else{if(V){var Y=document.selection;if(this[0].tagName.toLowerCase()!="textarea"){var R=this.val(),U=Y[M]()[O]();U.moveEnd("character",R[e]);var ac=(U.text==""?R[e]:R.lastIndexOf(U.text));U=Y[M]()[O]();U.moveStart("character",-R[e]);var X=U.text[e]}else{var U=Y[M](),P=U[O]();P.moveToElementText(this[0]);P.setEndPoint("EndToEnd",U);var ac=P.text[e]-U.text[e],X=ac+U.text[e]}}else{var ac=ab.selectionStart,X=ab.selectionEnd}var S=ab.value.substring(ac,X);return{start:ac,end:X,text:S,replace:function(ae){return ab.value.substring(0,ac)+ae+ab.value.substring(X,ab.value[e])}}}}})(q,"length","createRange","duplicate");
/*! [/jCaret] */
String.prototype.replaceAll=function(e,M){return this.split(e).join(M)};String.prototype.recursiveReplaceMap=function(P,O,M){if(M==0){return this.split(P[0]).join(O[0])}var N,e=this.split(P[M]);for(N in e){e[N]=e[N].recursiveReplaceMap(P,O,M-1)}return e.join(O[M])};String.prototype.replaceMap=function(e){var M,P,O,N;P=new Array();O=new Array();N=0;for(M in e){P.push(M);O.push(e[M]);N++}if(N==0){return this}else{return this.recursiveReplaceMap(P,O,N-1)}};String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")};var j=({getMeta:function(M,N){try{return q('meta[name="'+M+'"]').attr("content")}catch(O){if(arguments.length>1){return N}else{return null}}},getResource:function(N){var e={NAME:"",AMOUNT:0,getName:function(P){var O=this.NAME+"";j[P]=this.AMOUNT+0;return O}};var M=q("#"+N).attr("title");e.NAME=M.split(":").shift();e.AMOUNT=parseInt(M.split("/tr").shift().replace(/\D/g,""));return e},init:function(){return{LANGUAGE:this.getMeta("ogame-language",""),RES_MET:this.getResource("metal_box"),RES_CRY:this.getResource("crystal_box"),RES_DEU:this.getResource("deuterium_box")}}}).init();var s={
/*! [colors] */
MET:"#FF7700",CRY:"#00FFFF",DEU:"#FF33FF",SC:"#FFFFFF",LC:"#FFFFFF"
/*! [/colors] */
};var t=({text:{RES_MET:j.RES_MET.getName("RES_MET"),RES_CRY:j.RES_CRY.getName("RES_CRY"),RES_DEU:j.RES_DEU.getName("RES_DEU")},set:function(e,M){if(e.test(j.LANGUAGE)){q.extend(true,this.text,M)}return this}}
/*! [i18n=en] */
).set(/.*/,{THO_SEP:",",DEC_SEP:".",MENU:"Trace C.",TITLE:"Trade calculator",CONFIG:"Settings",ACTION:"Action",BUY:"I buy",SELL:"I sell",RATIO:"Ratio",ILLEGAL:"illegal",MAX:"Maximum",REG:"Regular",MIN:"Minimum",IN_EXCH:"In exchange for",RESULT:"Result",SEND:"I send",RECEIVE:"I receive",RES:"Resources",LC_SHIP:"LC",SC_SHIP:"SC",OR:"or",MESSAGE:"Message",WHERE:"Place of delivery",PLANET:"Planet",MOON:"Moon",CUR_PLA:"Current planet",SEL_CUR:"Select current planet or moon",RAT_LST:"Ratio list",NAME:"Name",LEGAL:"Legal",YES:"Yes",NO:"No",DEFAULT:"Default",NEW:"New",DEF_VAL:"Default values",ABB_KEY:"Abbreviations and auto-complete keys",USE_ABB:"Use abbreviations when possible",UNABB:"Unabbreviate fields when the mouse is over them",ABB_MIL:"Abbreviation for millions",ABB_THO:"Abbreviation for thousands",KEY_MIL:"Key to write millions (6 zeros)",KEY_THO:"Key to write thousands (3 zeros)",MES_TPL:"Message template",RES_DTP:"Restore default template",IE_CONF:"Import / Export configuration",IMPORT:"Import",EXPORT:"Export",ACCEPT:"Accept",CANCEL:"Cancel",RES_DEF:"Restore default settings",CONTACT:"Contact information"}
/*! [i18n=es] */
).set(/es|ar|mx/,{THO_SEP:".",DEC_SEP:",",MENU:"C. Comercio",TITLE:"Calculadora de comercio",CONFIG:"Configuración",ACTION:"Acción",BUY:"Compro",SELL:"Vendo",RATIO:"Ratio",ILLEGAL:"ilegal",MAX:"Máximo",REG:"Normal",MIN:"Mínimo",IN_EXCH:"A cambio de",RESULT:"Resultado",SEND:"Envío",RECEIVE:"Recibo",RES:"Recursos",LC_SHIP:"NGC",SC_SHIP:"NPC",OR:"o",MESSAGE:"Mensaje",WHERE:"Lugar de entrega",PLANET:"Planeta",MOON:"Luna",CUR_PLA:"Planeta actual",SEL_CUR:"Seleccionar planeta o luna actual",RAT_LST:"Lista de ratios",NAME:"Nombre",LEGAL:"Legal",YES:"Si",NO:"No",DEFAULT:"Por defecto",NEW:"Nuevo",DEF_VAL:"Valores por defecto",ABB_KEY:"Abreviaciones y teclas de autocompletado",USE_ABB:"Usar abreviaciones cuando sea posible",UNABB:"Desabreviar campos al poner el ratón encima",ABB_MIL:"Abreviación para millones",ABB_THO:"Abreviación para miles",KEY_MIL:"Tecla para escribir millones (6 ceros)",KEY_THO:"Tecla para escribir miles (3 ceros)",MES_TPL:"Plantilla de mensaje",RES_DTP:"Restaurar plantilla por defecto",IE_CONF:"Importar / Exportar configuración",IMPORT:"Importar",EXPORT:"Exportar",ACCEPT:"Aceptar",CANCEL:"Cancelar",RES_DEF:"Restaurar ajustes por defecto",CONTACT:"Información de contacto"}
/*! [i18n=nl] by sanctuary http://userscripts.org/users/431052 */
).set(/nl/,{THO_SEP:",",DEC_SEP:".",MENU:"Trace C.",TITLE:"Trade calculator",CONFIG:"Instellingen",ACTION:"Actie",BUY:"Ik koop",SELL:"Ik verkoop",RATIO:"Verhouding",ILLEGAL:"illegaal",MAX:"Maximaal",REG:"Gemiddeld",MIN:"Minimaal",IN_EXCH:"In ruil voor",RESULT:"Resultaat",SEND:"Ik verstuur",RECEIVE:"Ik ontvang",RES:"Grondstoffen",LC_SHIP:"GV",SC_SHIP:"KV",OR:"of",MESSAGE:"Bericht",WHERE:"Plaats van levering",PLANET:"Planeet",MOON:"Maan",CUR_PLA:"Huidige planeet",SEL_CUR:"Kies huidige planeet of maan",RAT_LST:"Verhouding lijst",NAME:"Naam",LEGAL:"Legaal",YES:"Ja",NO:"Nee",DEFAULT:"Standaard",NEW:"Nieuw",DEF_VAL:"Standaard waarde",ABB_KEY:"Toets afkortingen en automatisch aanvullen",USE_ABB:"Gebruik afkortingen wanneer mogelijk",UNABB:"Verkort velden wanneer de muis over het veld staat",ABB_MIL:"Afkorting voor miljoen",ABB_THO:"Afkorting voor duizend",KEY_MIL:"Toets voor miljoen te schrijven (6 nullen)",KEY_THO:"Toets voor duizend te schrijven (3 nullen)",MES_TPL:"Bericht sjabloon",RES_DTP:"Herstel standaard sjabloon",IE_CONF:"Invoer / Uitvoer configuratie",IMPORT:"Invoer",EXPORT:"Uitvoer",ACCEPT:"Accepteer",CANCEL:"Annuleer",RES_DEF:"Herstel naar standaard instellingen",CONTACT:"Contactinformatie"}
/*! [/i18n] */
).text;var h={
/*! [css] */
CSS:"#"+G+"window{float:left;position:relative;width:670px;overflow:visible;z-index:2;}#galaxy #"+G+"window{top:-44px;}#"+G+'header{height:28px;position: relative;background: url("http://gf1.geo.gfsrv.net/cdn63/10e31cd5234445e4084558ea3506ea.gif") no-repeat scroll 0px 0px transparent;}#'+G+"header h4{height:28px;line-height:28px;text-align:center;color:#6F9FC8;font-size:12px;font-weight:bold;position:absolute;top:0;left:100px;right:100px;}#"+G+"config_but{display:block;height:16px;width:16px;background:url(http://gf3.geo.gfsrv.net/cdne7/1f57d944fff38ee51d49c027f574ef.gif);float:right;margin:8px 0 0 0;opacity:0.5;}#"+G+"config_but:hover{opacity:1;}#"+G+'window.config input[type="button"]{margin:0 5px 0 5px;}#'+G+"config,#"+G+"window.config #"+G+"calc,#"+G+"window.config #"+G+"config_but,#"+G+"window.calc ."+G+"config_only{display:none;}#"+G+"window.config #"+G+"config{display:block;}#"+G+'main{padding:15px 25px 0 25px;background: url("http://gf1.geo.gfsrv.net/cdn9e/4f73643e86a952be4aed7fdd61805a.gif") repeat-y scroll 5px 0px transparent;}#'+G+"main *{font-size:11px;}#"+G+"window table{width:620px;background-color:#0D1014;border-collapse:collapse;clear:both;}#"+G+"window.calc table{border:1px solid #000;margin:0 0 20px 0;}#"+G+"window.calc table.last{margin:0;}#"+G+"window.config table{width:598px;}#"+G+"main th{color:#6F9FC8;text-align:center;font-weight:bold;}."+G+"label,."+G+"label *{color:grey;text-align:left;}."+G+"label{padding:0 5px 0 5px;font-weight:bold;}#"+G+"window.config ."+G+"label{text-align:center;}#"+G+"main tr,#"+G+"main td,#"+G+"main th{height:28px;line-height:28px;}#"+G+'main input[type="text"]{width:100px;text-align:center;}option.'+G+"highlight{color:lime !important;font-weight:bold;}option."+G+"moon{color:orange;}."+G+"select{width:150px;text-align:left;}."+G+"select select{width:130px;text-align:center;}#"+G+"main option{padding:1px 5px 1px 5px;}."+G+"input,."+G+"output{width:112px;padding:0 2px 0 0;}."+G+"name{width:142px;padding:0 1px 0 1px;text-align:right;}#"+G+"main ."+G+"name input{width:130px;text-align:center;}."+G+"ratio{width:82px;padding:0 1px 0 1px;text-align:right;}#"+G+"main ."+G+"ratio input{width:70px;text-align:center;}#"+G+"ratio_illegal{color:red;}."+G+"output{text-align:center;font-weight:bold;}#"+G+"output_met{color:"+s.MET+";}#"+G+"output_cry{color:"+s.CRY+";}#"+G+"output_deu{color:"+s.DEU+";}."+G+"textarea{padding:0 3px 0 3px !important;}#"+G+"message{width:601px;height:50px !important;margin:0 !important;}#"+G+"planet{width:auto;text-align:left;margin:0;}."+G+"select1row{padding-left:2px;}."+G+"select1row select{width:250px !important;text-align:left;margin:0;}#"+G+"selCurPla_button{margin-left:30px}#"+G+'footer{height:17px;background: url("http://gf1.geo.gfsrv.net/cdn30/aa3e8edec0a2681915b3c9c6795e6f.gif") no-repeat scroll 2px 0px transparent;}.'+G+'config_title{font-size:11px;font-weight:bold;color:#6F9FC8;line-height:22px;background:url("http://gf1.geo.gfsrv.net/cdn0b/d55059f8c9bab5ebf9e8a3563f26d1.gif") no-repeat scroll 0 0 #13181D;height:22px;margin:0 0 10px 0;padding:0 0 0 40px;border:1px solid #000;overflow:hidden;cursor:pointer;}.'+G+"config_title:hover{color:#A7AFB7;background-color:#23282D;border-color:#13181D;}."+G+"config_box{border:1px solid #000;margin:5px 5px 10px 5px;padding:5px;}#"+G+"new_ratio input{border-color:#9C0;}."+G+"check,."+G+"name_noedit{text-align:center;}."+G+"check input{vertical-align:text-bottom;}."+G+'check input[type="checkbox"]{vertical-align:middle;}.'+G+"action{text-align:center;padding:0 3px 0 3px;}."+G+'action a{background:url("http://gf1.geo.gfsrv.net/cdn94/297ee218d94064df0a66bd41a04d28.png") scroll 0 0 no-repeat;width:16px;height:16px;display:inline-block;vertical-align:top;position:relative;top:5px;border:1px solid #000;border-radius:2px;opacity:0.7;}a.'+G+"icon_up,a."+G+"icon_down,a."+G+"icon_add{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAwCAMAAAAvgQplAAAAAXNSR0IArs4c6QAAAvpQTFRFbomeXHaLb4mdgpyveJaxdpSweZKk////W3qXVnKNRWB6AAAANTU1PT09MUJTJzVD/6gAzAAA/9IA/wAAqsrjvtjrna25PlVsTWiCqbjESGF6YHyaOk9ldZOwTWeCPj4+PlRsVHeYRGKBUXCRQVx6VnibTGmFVnmbRWOERWSEXn+chJusPVhzU3SVQ19+TGyKU3aXPVRrTGqHkrHKPVZwUW6KQ2GAU3aZO09lcJCqYHqORV95UW6LTGeBQFlySGB5SmF6Q2B+VnmaUG2JVnSQS2qHSmeCL0RaXHmUU3WVoLzSqcTYQ2GCPFZxPVZxkaa1RWSDPFZyRl96XH2ZTGqGS2qJO1Ru1d7lV3SROk5kQVp0QVpz5erua4OWqLnGpcDUWn2ewMzVlK/EqLbCcY+qj6zESmF3r7zHob3TTGaAlqi2haO9XniNQ115TWiD8vX4k7DGZ4mqyNTdSmaBpcHWcImdjaKynbrRdY6hvMnTSWeHYXyaq7jDV3SQ6+/zo7/Ur8rd8PP1javGhaK82uLmq8bZq7vHh6a+0NrgnLjOhJqqUG+QpL/VsL7JdJOuXnmSytTcj6OxT2qE+Pn7eZm0zCszfZmxhqXBdZGpXHaOS2uKboynr73J4ebrhKO7obLAmLfR+vv9nLfNip+uX3yYXn+bdoyec42gobC9pbS/yNPbYX2aPVRtt8XPmLTLbo2odI2geI2fVHKT2OHo3OLoRGGBRmODkK7HaImkaomka4unjaCw/f7/mbjRXnyXd4+jf5Wmp8HWjq3IiqnEeZOqPlVtVHeXYH2ai6CxYYCbZIKfZn+TTGeDVnWQb5GtVnWRSWWASmWATGuKc5CpusXOU3GQlLPMXHqXUnSUZoSifJq0fJu3ZHyT/v//dpOwqcXZYHqSYnuQ7fDz7PD0XHyYWnaRkKW1TGiFTGmEj6zDYXuPPFdzPVdzrsndhpytVHaYh52uXn6c8PP2jqzFQFt5jKvFcYqeQl99gZ+52uHmRGKAyNTcV3iaqsbZDVW+rgAAAAF0Uk5TAEDm2GYAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3AsJFTcNV6u1fQAAAE9JREFUKM/dkjEOACAIA6tL//9jFaORqhtxsBO9CS4AyQXSKwkEpAfkIMgttNh4AUtCALQ/9NGPu4A87/erj/6DD30HBZuPwztsPmIFqY8CjdEFo21taJsAAAAASUVORK5CYII=);}a."+G+"icon_down{background-position:0px -16px}a."+G+"icon_add{background-position:0px -32px}."+G+"action a:hover{opacity:1;border-color:#08090b;}."+G+"action a.disabled,."+G+"action aldisabled:hover{opacity:0.1;cursor:default;}a."+G+"icon_trash{background-position:0px -304px}#"+G+"window.config .undermark,#"+G+"window.config .overmark{font-weight:bold;text-align:center;}#"+G+"window.config textarea{display:block;width:586px;margin:0 0 5px 0;}."+G+"ie_conf{text-align:center}."+G+"hidden{position:fixed;left:-10000px;}."+G+"fieldwrapper:before,."+G+'fieldwrapper:after{content:"";display:table;}.'+G+"fieldwrapper:after{clear:both;}."+G+"fieldwrapper{padding:7px 0 7px 0;}."+G+"fieldwrapper label,."+G+"thefield{color:#6F9FC8;height:22px;line-height:22px;float:left;margin:2px 0 0 0;}."+G+"fieldwrapper label{font-weight:bold;width:320px;margin:0 15px 0 0;padding:0 0 0 10px;}."+G+'thefield input[type="text"],.'+G+"thefield select{width:200px}",
/*! [tpl=action_options] */
ACTION_OPT:'<option value="sell">'+t.SELL+'</option><option value="buy">'+t.BUY+"</option>",
/*! [tpl=output_options] */
OUTPUT_OPT:'<option value="m">'+t.RES_MET+'</option><option value="c">'+t.RES_CRY+'</option><option value="d">'+t.RES_DEU+'</option><option value="mc">'+t.RES_MET+" + "+t.RES_CRY+'</option><option value="md">'+t.RES_MET+" + "+t.RES_DEU+'</option><option value="cd">'+t.RES_CRY+" + "+t.RES_DEU+"</option>",
/*! [tpl=void_href] */
VOID_HREF:'href="javascript:void(0)"',
/*! [tpl=window] */
WINDOW:'<div id="'+G+'window" class="calc"><div id="'+G+'header"><h4>'+t.TITLE+'<span class="'+G+'config_only"> &raquo; '+t.CONFIG+'</span></h4><a id="'+G+'close" href="javascript:void(0);" class="close_details close_ressources"></a><a id="'+G+'config_but" href="javascript:void(0);"></a></div><div id="'+G+'main"><div id="'+G+'calc"><table cellspacing="0" cellpadding="0"><tbody><tr><th colspan="2"></th><th>'+t.RES_MET+"</th><th>"+t.RES_CRY+"</th><th>"+t.RES_DEU+'</th></tr><tr class="alt"><td class="'+G+'label">'+t.ACTION+'</td><td class="'+G+'select"><select id="'+G+'action">{this.ACTION_OPT}</select></td><td class="'+G+'input"><input id="'+G+'input_met" type="text" value=""></td><td class="'+G+'input"><input id="'+G+'input_cry" type="text" value=""></td><td class="'+G+'input"><input id="'+G+'input_deu" type="text" value=""></td></tr><tr><td class="'+G+'label">'+t.RATIO+'<span id="'+G+'ratio_illegal"> ('+t.ILLEGAL+')</span></td><td class="'+G+'select"><select id="'+G+'ratio"></select></td><td class="'+G+'input"><input id="'+G+'ratio_met" type="text" value=""></td><td class="'+G+'input"><input id="'+G+'ratio_cry" type="text" value=""></td><td class="'+G+'input"><input id="'+G+'ratio_deu" type="text" value=""></td></tr><tr class="alt"><td class="'+G+'label">'+t.IN_EXCH+'</td><td class="'+G+'select"><select id="'+G+'output">{this.OUTPUT_OPT}</select></td><td class="'+G+'input"><input id="'+G+'percent_met" type="text" value=""></td><td class="'+G+'input"><input id="'+G+'percent_cry" type="text" value=""></td><td class="'+G+'input"><input id="'+G+'percent_deu" type="text" value=""></td></tr><tr><td class="'+G+'label" colspan="2">'+t.RESULT+'</td><td class="'+G+'output" id="'+G+'output_met"></td><td class="'+G+'output" id="'+G+'output_cry"></td><td class="'+G+'output" id="'+G+'output_deu"></td></tr></tbody></table><table cellspacing="0" cellpadding="0"><tbody><tr><th></th><th>'+t.RES+"</th><th>"+t.LC_SHIP+"</th><th>"+t.SC_SHIP+'</th></tr><tr class="alt"><td class="'+G+'label">'+t.SEND+'</td><td class="'+G+'output overmark" id="'+G+'sendRes">0</td><td class="'+G+'output" id="'+G+'sendLC">0</td><td class="'+G+'output" id="'+G+'sendSC">0</td></tr><tr><td class="'+G+'label">'+t.RECEIVE+'</td><td class="'+G+'output undermark" id="'+G+'receiveRes">0</td><td class="'+G+'output" id="'+G+'receiveLC">0</td><td class="'+G+'output" id="'+G+'receiveSC">0</td></tr></tbody></table><table cellspacing="0" cellpadding="0"><tbody><tr class="alt"><td class="'+G+'label" colspan="5">'+t.WHERE+'</td></tr><tr class="alt"><td class="'+G+'select1row" colspan="5"><select id="'+G+'planet"></select><a {this.VOID_HREF} id="'+G+'selCurPla_button">'+t.SEL_CUR+'</a></td></tr></tbody></table><table cellspacing="0" cellpadding="0" class="last"><tbody><tr class="alt"><td class="'+G+'label" colspan="5">'+t.MESSAGE+'</td></tr><tr class="alt"><td class="'+G+'textarea" colspan="5"><textarea id="'+G+'message" cols="1" rows="1" readonly="readonly"></textarea></td></tr></tbody></table></div><div id="'+G+'config"><div class="'+G+'config_title">'+t.RAT_LST+'</div><div class="'+G+'config_box"><table cellspacing="0" cellpadding="0"><tbody id="'+G+'ratioList"><tr><th>#</th><th>'+t.NAME+"</th><th>"+t.RES_MET+"</th><th>"+t.RES_CRY+"</th><th>"+t.RES_DEU+"</th><th>"+t.ACTION+"</th><th>"+t.LEGAL+"</th><th>"+t.DEFAULT+'</th></tr></tbody></table></div><div class="'+G+'config_title">'+t.DEF_VAL+'</div><div class="'+G+"config_box "+G+'hidden"><div class="'+G+'fieldwrapper"><label>'+t.ACTION+':</label><div class="'+G+'thefield"><select id="'+G+'defAction">{this.ACTION_OPT}</select></div></div><div class="'+G+'fieldwrapper"><label>'+t.IN_EXCH+':</label><div class="'+G+'thefield"><select id="'+G+'defOutput">{this.OUTPUT_OPT}</select></div></div><div class="'+G+'fieldwrapper"><label>'+t.SEL_CUR+':</label><div class="'+G+'thefield"><input id="'+G+'selCurPla" type="checkbox" /></div></div></div><div class="'+G+'config_title">'+t.ABB_KEY+'</div><div class="'+G+"config_box "+G+'hidden"><div class="'+G+'fieldwrapper"><label>'+t.USE_ABB+':</label><div class="'+G+'thefield"><input id="'+G+'abb" type="checkbox" /></div></div><div class="'+G+'fieldwrapper"><label>'+t.UNABB+':</label><div class="'+G+'thefield"><input id="'+G+'overUnabb" type="checkbox" /></div></div><div class="'+G+'fieldwrapper"><label>'+t.ABB_MIL+':</label><div class="'+G+'thefield"><input id="'+G+'millionAbb" type="text" maxlength="10" /></div></div><div class="'+G+'fieldwrapper"><label>'+t.ABB_THO+':</label><div class="'+G+'thefield"><input id="'+G+'thousandAbb" type="text" maxlength="10" /></div></div><div class="'+G+'fieldwrapper"><label>'+t.KEY_MIL+':</label><div class="'+G+'thefield"><input id="'+G+'millionKey" type="text" maxlength="1" /></div></div><div class="'+G+'fieldwrapper"><label>'+t.KEY_THO+':</label><div class="'+G+'thefield"><input id="'+G+'thousandKey" type="text" maxlength="1" /></div></div></div><div class="'+G+'config_title">'+t.MES_TPL+'</div><div class="'+G+"config_box "+G+'hidden"><textarea id="'+G+'messageTpl"></textarea><div class="textCenter"><input id="'+G+'messageTpl_restore" type="button" value="'+t.RES_DTP+'" class="btn_blue"></div></div><div class="'+G+'config_title">'+t.IE_CONF+'</div><div class="'+G+"config_box "+G+"ie_conf "+G+'hidden"><textarea id="'+G+'ie_conf"></textarea><input id="'+G+'ie_import" type="button" value="'+t.IMPORT+'" class="btn_blue"><input id="'+G+'ie_export" type="button" value="'+t.EXPORT+'" class="btn_blue"></div><div class="'+G+'config_title">'+t.CONTACT+'</div><div class="'+G+"config_box "+G+'hidden"><table cellspacing="0" cellpadding="0"><tbody><tr class="alt"><td class="'+G+"label "+G+'pos">1</td><td>Userscripts</td><td><a href="http://userscripts.org/scripts/discuss/151002" target="_blank">Discuss OGame Trade Calculator - userscripts.org</a></td></tr><tr><td class="'+G+"label "+G+'pos">2</td><td>Ogame Origin</td><td><a href="http://board.origin.ogame.de/board6-origin/board38-tools-scripts-skins/board39-tolerated-tools-addons-scripts/4367-ogame-trade-calculator/" target="_blank">[Tolerated] OGame Trade Calculator - board.origin.ogame.de</a></td></tr><tr class="alt"><td class="'+G+"label "+G+'pos">3</td><td>Ogame España</td><td><a href="http://board.ogame.com.es/board859-ogamelacomunidad/board860-comunidad/board422-utilidadesyskinsparaogame/1224751-scriptcalculadoradecomerciolegal/" target="_blank">[Script] Calculadora de Comercio [Legal] - board.ogame.com.es</a></td></tr></tbody></table></div><div class="textCenter"><input id="'+G+'config_accept" type="button" value="'+t.ACCEPT+'" class="btn_blue"><input id="'+G+'config_cancel" type="button" value="'+t.CANCEL+'" class="btn_blue"><input id="'+G+'config_default" type="button" value="'+t.RES_DEF+'" class="btn_blue"></div></div></div><div id="'+G+'footer"></div></div>',
/*! [tpl=button] */
MENUBUTTON:'<li><a id="'+G+'menubutton" class="menubutton" href="javascript:void(0)" accesskey="" target="_self"><span class="textlabel">'+t.MENU+"</span></a></li>",
/*! [tpl=ratio_list_limit] */
RATIO_LIST_LIMIT:'<tr><td class="'+G+"label "+G+'pos"></td><td class="'+G+'name_noedit"></td><td class="'+G+'ratio"><input class="'+G+'edit_ratio_met" type="text" /></td><td class="'+G+'ratio"><input class="'+G+'edit_ratio_cry" type="text" /></td><td class="'+G+'ratio"><input class="'+G+'edit_ratio_deu" type="text" /></td><td class="'+G+'action"><a {this.VOID_HREF} class="'+G+'icon_up"></a><a {this.VOID_HREF} class="'+G+'icon_down"></a><a {this.VOID_HREF} class="'+G+'icon_trash disabled"></a></td><td class="'+G+'label">-</td><td class="'+G+'check"><input name="'+G+'def_ratio" type="radio" /></td></tr>',
/*! [tpl=ratio_list_item] */
RATIO_LIST_ITEM:'<tr><td class="'+G+"label "+G+'pos"></td><td class="'+G+'name"><input class="'+G+'edit_ratio_name" type="text" /></td><td class="'+G+'ratio"><input class="'+G+'edit_ratio_met" type="text" /></td><td class="'+G+'ratio"><input class="'+G+'edit_ratio_cry" type="text" /></td><td class="'+G+'ratio"><input class="'+G+'edit_ratio_deu" type="text" /></td><td class="'+G+'action"><a {this.VOID_HREF} class="'+G+'icon_up"></a><a {this.VOID_HREF} class="'+G+'icon_down"></a><a {this.VOID_HREF} class="'+G+'icon_trash"></a></td><td class="'+G+'legal"></td><td class="'+G+'check"><input name="'+G+'def_ratio" type="radio" /></td></tr>',
/*! [tpl=ratio_list_new] */
RATIO_LIST_NEW:'<tr id="'+G+'new_ratio"><td class="undermark '+G+'pos"></td><td class="'+G+'name"><input class="'+G+'edit_ratio_name" type="text" /></td><td class="'+G+'ratio"><input class="'+G+'edit_ratio_met" type="text" /></td><td class="'+G+'ratio"><input class="'+G+'edit_ratio_cry" type="text" /></td><td class="'+G+'ratio"><input class="'+G+'edit_ratio_deu" type="text" /></td><td class="'+G+'action"><a {this.VOID_HREF} class="'+G+'icon_add"></a></td><td class="'+G+'legal"></td><td class="'+G+'label">-</td></tr>',
/*! [/tpl] */
init:function(){for(var M in this){if(typeof(this[M])=="string"){for(var e in this){if(typeof(this[e])=="string"){this[M]=this[M].replaceAll("{this."+e+"}",this[e])}}}}}};var B=(function(){var e=q('meta[name="ogame-universe"]').attr("content");
/*! [default_ratios] */
return/^\w+\.ogame\.org$/.test(e)?[3,2,1,2,1,1,3,2,1]:[5,3,1,2,1.5,1,3,2,1];
/*! [/default_ratios] */
})();var y=function(){return(new Date()).getTime()};var a=function(){};var u=function(M){M.preventDefault()};var J={getDefaultData:function(){return{
/*! [config=default] */
version:v.VERSION.slice(0),defAction:"sell",ratioList:[{id:"MAX",ratio:[B[0],B[1],B[2]]},{id:"MIN",ratio:[B[3],B[4],B[5]]},{id:"REG",ratio:[B[6],B[7],B[8]]}],defRatio:"REG",defOutput:"m",millionAbb:"M",millionKey:"m",thousandAbb:"K",thousandKey:"k",abb:false,overUnabb:false,selCurPla:false,messageTpl:"[b]{?b}{I18N.BUY}{/b}{?s}{I18N.SELL}{/s}:[/b] {?m}[b][color={COLOR.MET}]{m}[/color][/b] ({I18N.RES_MET}){?cd} + {/cd}{/m}{?c}[b][color={COLOR.CRY}]{c}[/color][/b] ({I18N.RES_CRY}){?d} + {/d}{/c}{?d}[b][color={COLOR.DEU}]{d}[/color][/b] ({I18N.RES_DEU}){/d}\n[b]{I18N.IN_EXCH}:[/b] {?M}[b][color={COLOR.MET}]{M}[/color][/b] ({I18N.RES_MET}){?CD} + {/CD}{/M}{?C}[b][color={COLOR.CRY}]{C}[/color][/b] ({I18N.RES_CRY}){?D} + {/D}{/C}{?D}[b][color={COLOR.DEU}]{D}[/color][/b] ({I18N.RES_DEU}){/D}\n\n[b]* {I18N.SEND}:[/b] {sr} ({I18N.RES}) = [b][color={COLOR.LC}]{sl}[/color][/b] ({I18N.LC_SHIP}) {I18N.OR} [b][color={COLOR.SC}]{ss}[/color][/b] ({I18N.SC_SHIP})\n[b]* {I18N.RECEIVE}:[/b] {rr} ({I18N.RES}) = [b][color={COLOR.LC}]{rl}[/color][/b] ({I18N.LC_SHIP}) {I18N.OR} [b][color={COLOR.SC}]{rs}[/color][/b] ({I18N.SC_SHIP})\n\n[b]* {I18N.RATIO}:[/b] {rm}:{rc}:{rd}{?w}\n[b]* {I18N.WHERE}:[/b] {wg}:{ws}:{wp} ({wt}){/w}\n\n[b][url={SCRIPT.HOME_URL}]{SCRIPT.NAME}[/url][/b]"
/*! [/config] */
}},abbRE:/^\S+$/,keyRE:/^\S$/,_error:function(e){throw"DataError: "+e},_errorUndefined:function(e){this._error(e+" is undefined")},_errorExpected:function(M,N,O,P){var R,Q=O+"";if(/^[\<\>]\d+$/.test(Q)){if(Q.charAt(0)==">"){R="greater"}else{R="less"}R+=" than "+Q.slice(1)}else{R='"'+Q.split(":").join(" or ")+'"'}this._error(M+": "+N+" "+R+' expected but "'+P+'" found')},_errorType:function(e,M,N){if(N=="undefined"){this._errorUndefined(e)}else{this._errorExpected(e,"type",M,N)}},_errorValue:function(e,M,N){this._errorExpected(e,"value",M,N)},_errorValueRE:function(e,M,N){this._error(e+': value "'+N+'" doesn\'t match the expected RegExp "'+M+'"')},_errorLength:function(e,M,N){this._errorExpected(e,"length",M,N)},parseData:function(M){var N,e,V,O=this,P=(typeof(M)=="string")?JSON.parse(M):M,W="boolean",U="string",Q="number";if((V=typeof(P.defAction))!=U){O._errorType("defAction",U,V)}if(typeof(P.ratioList)=="undefined"){O._errorUndefined("ratioList")}if(!(/^sell|buy$/.test(P.defAction))){O._errorValue("defAction","sell:buy",P.defAction)}V=typeof(P.defRatio);if(!(/^number|string$/.test(V))){O._errorType("defRatio",U+":"+Q,V)}var R=true,S=true,T=true;for(N=0;N<P.ratioList.length;N++){e=P.ratioList[N];if((V=e.ratio.length)!=3){O._errorLength("ratioList["+N+"]",3,V)}if((e.ratio[0]+=0)<=0){O._errorValue("ratioList["+N+"].ratio[0]",">0",e.ratio[0])}if((e.ratio[1]+=0)<=0){O._errorValue("ratioList["+N+"].ratio[1]",">0",e.ratio[1])}if((e.ratio[2]+=0)<=0){O._errorValue("ratioList["+N+"].ratio[2]",">0",e.ratio[2])}if(e.id==P.defRatio){T=false}if(/^MAX|MIN|REG$/.test(e.id+"")){if(e.id=="MAX"){R=false}else{if(e.id=="MIN"){S=false}}}else{if((V=typeof(e.id))!=Q){O._errorType("ratioList["+N+"].id",Q,V)}if((V=typeof(e.name))!=U){O._errorType("ratioList["+N+"].name",U,V)}}}if(R){O._error('ratioList: maximum ratio (id="MAX") not found')}if(S){O._error('ratioList: minimum ratio (id="MIN") not found')}if(T){O._error('ratioList: default ratio (id="'+P.defRatio+'" == defRatio) not found')}e=P.ratioList.slice(0).sort();for(N=1;N<e.length;N++){if(e[N-1].id==e[N].id){O._error('ratioList: duplicate id "'+e[N].id+'" found')}}if(!(/^m|c|d|mc|md|cd$/.test(P.defOutput))){O._errorValue("defOutput","m:c:d:mc:md:cd",P.defOutput)}if((V=typeof(P.millionAbb))!=U){O._errorType("millionAbb",U,V)}if((V=P.millionAbb.length)<1){O._errorLength("millionAbb",">0",V)}if(!O.abbRE.test(V=P.millionAbb)){O._errorValueRE("millionAbb",O.abbRE,V)}if((V=typeof(P.millionKey))!=U){O._errorType("millionKey",U,V)}if((V=P.millionKey.length)!=1){O._errorLength("millionKey",1,V)}if(!O.keyRE.test(V=P.millionKey)){O._errorValueRE("millionKey",O.keyRE,V)}if((V=typeof(P.thousandAbb))!=U){O._errorType("thousandAbb",U,V)}if((V=P.thousandAbb.length)<1){O._errorLength("thousandAbb",">0",V)}if(!O.abbRE.test(V=P.thousandAbb)){O._errorValueRE("thousandAbb",O.abbRE,V)}if((V=typeof(P.thousandKey))!=U){O._errorType("thousandKey",U,V)}if((V=P.thousandKey.length)!=1){O._errorLength("thousandKey",1,V)}if(!O.keyRE.test(V=P.thousandKey)){O._errorValueRE("thousandKey",O.keyRE,V)}if((V=typeof(P.abb))!=W){O._errorType("abb",W,V)}if((V=typeof(P.overUnabb))!=W){O._errorType("overUnabb",W,V)}if((V=typeof(P.selCurPla))!=W){O._errorType("selCurPla",W,V)}if((V=typeof(P.messageTpl))!=U){O._errorType("messageTpl",U,V)}return P},getRatio:function(M,P){var O=(arguments.length>1)?P.ratioList[M]:this.data.ratioList[M],Q=O.id+"",e,N=O.ratio.slice(0);if("name" in O){e=O.name+""}else{e=t[Q]}return{id:Q,ratio:N,name:e,val:Q+":"+N[0]+":"+N[1]+":"+N[2],met:N[0],cry:N[1],deu:N[2]}},getRatioById:function(P,N){var e,O=(arguments.length>1)?N:this.data,M=O.ratioList;for(e in M){if(M[e].id==P){return this.getRatio(e,O)}}return null},updateVersion:function(O){var e=(typeof(O.version)=="undefined")?0:O.version,M,N=this.getDefaultData();if(r(e,[2,4])){O.messageTpl=N.messageTpl}O.version=N.version;for(M in N){if(typeof(O[M])=="undefined"){O[M]=N[M]}}return O},save:function(e){if(arguments.length>0){this.data=e}I.set("config",this.data);return this},load:function(){var e=I.get("config");if(e==null){this.data=this.getDefaultData()}else{this.save(this.updateVersion(e))}return this},remove:function(){I.remove("config");this.data=this.getDefaultData()}};var w={formatI:function(P,N){var O,e=(arguments.length>1&&N);if(e&&P==""){return""}if(typeof(P)=="string"){O=("0"+P+"").replace(new RegExp(J.data.thousandKey+"$","i"),"000").replace(new RegExp(J.data.millionKey+"$","i"),"000000").replace(/\D/g,"").replace(/^0+(\d)/,"$1")}else{O=P.toFixed()+""}var M=/(\d+)(\d{3})/;while(M.test(O)){O=O.replace(M,"$1"+t.THO_SEP+"$2")}if(!e&&J.data.abb){return O.replace(/\D000\D000$/,J.data.millionAbb).replace(/\D(\d*[1-9]+)0*\D000$/,t.DEC_SEP+"$1"+J.data.millionAbb).replace(/\D000$/,J.data.thousandAbb)}return O},formatF:function(S,Q){var R,e,P,N,M=(arguments.length>1&&Q);if(M&&S==""){return""}if(typeof(S)=="string"){R=("0"+S+"").replace(/[\.\,]$/,t.DEC_SEP).replace(new RegExp("[^0-9\\"+t.DEC_SEP+"]","g"),"").replace(/^0+(\d)/,"$1")}else{R=(S+"").replace(".",t.DEC_SEP)}e=R.split(t.DEC_SEP);P=e[0];N=e.length>1?t.DEC_SEP+e[1]:"";if(R[R.length-1]==t.DEC_SEP&&M){N=t.DEC_SEP}var O=/(\d+)(\d{3})/;while(O.test(P)){P=P.replace(O,"$1"+t.THO_SEP+"$2")}return P+N},parseI:function(M){var e=w.parseF(M);if(new RegExp(J.data.thousandAbb+"$","i").test(M)){e=e*1000}else{if(new RegExp(J.data.millionAbb+"$","i").test(M)){e=e*1000000}}return Math.round(e)},parseF:function(e){return parseFloat(e.replaceAll(t.THO_SEP,"").replace(t.DEC_SEP,".").replace(/[^\d\.]/g,""))}};var K=function(){if(arguments.length<1){this.setLimits()}else{if(arguments.length<2){this.setLimits(arguments[0])}else{this.setLimits(arguments[0],arguments[1])}}};K.prototype={limits:[],isLegal:function(){var N;if(arguments.length==1){N=arguments[0]}else{N=[arguments[0],arguments[1],arguments[2]]}var M=N[0]/N[1],e=0;if(M<this.limits[e++]||M>this.limits[e++]){return false}M=N[0]/N[2];if(M<this.limits[e++]||M>this.limits[e++]){return false}M=N[1]/N[2];if(M<this.limits[e++]||M>this.limits[e++]){return false}return true},setLimits:function(O,N){if(arguments.length<2){var S,R,P,Q=(arguments.length>0)?O.ratioList:J.data.ratioList;for(P in Q){if(Q[P].id=="MAX"){S=Q[P].ratio}else{if(Q[P].id=="MIN"){R=Q[P].ratio}}}return this.setLimits(S,R)}this.limits=[];var M=O[0]/O[1],e=N[0]/N[1];this.limits.push(Math.min(M,e));this.limits.push(Math.max(M,e));M=O[0]/O[2];e=N[0]/N[2];this.limits.push(Math.min(M,e));this.limits.push(Math.max(M,e));M=O[1]/O[2];e=N[1]/N[2];this.limits.push(Math.min(M,e));this.limits.push(Math.max(M,e));return this}};var A,x;var f=function(P,Q,O,S,T,R,M,N,e){return{met:Math.round(((P+(Q/T)*S+(O/R)*S)/100)*M),cry:Math.round((((P/S)*T+Q+(O/R)*T)/100)*N),deu:Math.round((((P/S)*R+(Q/T)*R+O)/100)*e)}};var E={parseIf:function(R,S,e){var T="{?"+S+"}",O="{/"+S+"}";if(e){return R.split(T).join("").split(O).join("")}var Q,P,M,N=R;while((Q=N.indexOf(T))>=0&&(P=N.indexOf(O))>=0&&Q<P){N=N.split(T);for(Q=1;Q<N.length;Q++){M=N[Q].split(O);if(M.length>1){M.shift();N[Q]=O+M.shift()+M.join(O)}}N=N.join(T).split(T+O).join("")}return N},parseIfs:function(Q,U){var P=Q+"",O=Q+"",W=/\{\?(\!?\w)+\}/,S,V,T,N,M;while(W.test(P)){S=(W.exec(P)+"").replace(/\}.*$/,"").replace(/^.*\{/,"");P=P.split("{"+S+"}").join("");try{S=S.replace(/[^\w\!]/g,"");if((M=S[T=0])=="!"){V=!U[++T]}else{V=U[M]}N=S.length-1;V=U[S[T]];while(T<N){if((M=S[++T])=="!"){V=(V||!U[++T])}else{V=(V||U[M])}}O=this.parseIf(O,S,V)}catch(R){alert(R)}}return O},make:function(O,T,e,N,M,S,Q){var R,U=/[1-9]/,P=this.parseIfs(J.data.messageTpl,{b:(O=="buy"),s:(O=="sell"),m:U.test(T.met),c:U.test(T.cry),d:U.test(T.deu),M:U.test(e.met),C:U.test(e.cry),D:U.test(e.deu),w:Q.use});P=P.replaceMap({"{m}":T.met,"{c}":T.cry,"{d}":T.deu,"{M}":e.met,"{C}":e.cry,"{D}":e.deu,"{sr}":N.res,"{sl}":N.lc,"{ss}":N.sc,"{rr}":M.res,"{rl}":M.lc,"{rs}":M.sc,"{rm}":S.met,"{rc}":S.cry,"{rd}":S.deu,"{wg}":Q.galaxy,"{ws}":Q.system,"{wp}":Q.planet,"{wt}":Q.use?"{I18N."+(Q.type+"").toUpperCase()+"}":0});for(R in t){P=P.replaceAll("{I18N."+R+"}",t[R])}for(R in v){P=P.replaceAll("{SCRIPT."+R+"}",v[R])}for(R in s){P=P.replaceAll("{COLOR."+R+"}",s[R])}return P}};var C=function(M,e){this.jqo=M;if(arguments.length>1){this.val(e)}};C.prototype={val:function(e){if(arguments.length<1){return this.jqo.val()}this.jqo.val(e);return this},disable:function(){this.jqo.attr("disabled","disabled").prop("disabled",true);return this},enable:function(){this.jqo.prop("disabled",false).removeAttr("disabled");return this},isDisabled:function(){return(this.jqo.attr("disabled")=="disabled")}};var z=function(M,e){this.jqo=M;if(arguments.length>1){this.val(e)}};z.prototype=q.extend({},C.prototype,{val:function(e){if(arguments.length<1){return this.isChecked()}if(e){this.check()}else{this.uncheck()}return this},check:function(){this.jqo.attr("checked","checked").prop("checked",true);return this},uncheck:function(){this.jqo.prop("checked",false).removeAttr("checked");return this},isChecked:function(){return(this.jqo.attr("checked")=="checked")}});var g=function(Q,P,N,O){var R=this,e=(R.jqo=Q),M;R.value=P;R.regExp=N;R.clearOnFocus=O;R.allowEmpty=true;R.onChange=a;if(arguments.length>4){if(arguments.length>5){R.allowEmpty=arguments[4];R.onChange=arguments[5]}else{if(typeof(arguments[4])=="function"){R.onChange=arguments[4]}else{R.allowEmpty=(arguments[4]&&true)}}}M=function(){var U=e.val(),S=U.length;p.console.log(R.regExp,'"'+U+'"',R.regExp.test(U));if(R.allowEmpty||S>0){if(R.regExp.test(U)){R.value=U.trim()}else{var V=e.caret(),W=S-V.start,T=S-V.end;S=R.value.length;W=Math.max(Math.min(S-W,S),0);T=Math.max(Math.min(S-T,S),0);e.val(R.value);e.caret(W,T)}R.onChange()}};e.val(P).keyup(M).change(M).blur(function(){e.val(R.value)}).focus(function(){if(R.clearOnFocus){if(R.allowEmpty){R.val("")}else{e.val("")}}})};g.prototype=q.extend({},C.prototype,{val:function(e){if(arguments.length<1){return this.value}this.jqo.val(this.value=e);return this}});var o=function(R,Q,P,O){var S=this,e=(this.jqo=R),N,M=P;this.allow0=true;this.focused=false;this.onChange=a;this.clearOnFocus=O;M=P.substring(0,1).toUpperCase();if(this.typePercent=(M=="P")){M="F"}this.formatFunc=w["format"+M];this.parseFunc=w["parse"+M];if(arguments.length>4){if(arguments.length>5){this.allow0=arguments[4];this.onChange=arguments[5]}else{if(typeof(arguments[4])=="function"){this.onChange=arguments[4]}else{this.allow0=(arguments[4]&&true)}}}this.set(Q);N=function(){var X=S.jqo,V=X.val(),W=X.caret(),T=V.length,Y=T-W.start,U=T-W.end;V=S.formatFunc(X.val(),true);T=V.length;Y=Math.max(Math.min(T-Y,T),0);U=Math.max(Math.min(T-U,T),0);num=(V=="")?0:S.parseFunc(V);if(S.allow0||num>0){S.set(V,true).onChange(S)}X.caret(Y,U)};e.keyup(function(T){if(!(/^9|16$/.test(T.which+""))){N()}}).change(N).blur(function(){S.set(S.num);S.focused=false}).focus(function(){S.focused=true;var V=q(this);if(S.clearOnFocus||S.num==0){V.val("")}else{var U=V.caret(),T=V.val().length;V.val(S.formatFunc(S.num,true));if(U.end==T){if(U.start==T){U.start=(--U.end)}else{U.end--}}T=V.val().length;V.caret(Math.min(Math.max(0,U.start),T),Math.min(Math.max(0,U.end),T))}}).mouseenter(function(){if(J.data.overUnabb&&!(S.typePercent||S.focused||S.clearOnFocus)){var T=S.jqo;T.val(S.formatFunc(S.num,true));if(T.val()==""){T.val(0)}}}).mouseleave(function(){if(J.data.overUnabb&&!(S.typePercent||S.focused||S.clearOnFocus)){S.jqo.val(S.txt)}})};o.prototype=q.extend({},C.prototype,{set:function(O,N){var e,M=(arguments.length>1&&N);if(typeof(O)=="string"){e=(O+"").replace(/\%$/,"");this.num=(e=="")?0:this.parseFunc(e);this.txt=this.formatFunc(this.num)+(this.typePercent?"%":"")}else{this.num=O;this.txt=(e=this.formatFunc(O))+(this.typePercent?"%":"")}this.jqo.val(M?e:this.txt);return this}});var b=function(M,e){var N=this;N.jqo=M;N.val(e);N.jqo.mouseenter(function(){N._mouseenter()}).mouseleave(function(){N._mouseleave()})};b.prototype={val:function(e){if(arguments.length>0){this.jqo.text(w.formatI(e));this.num=e;return this}return this.jqo.text()},_mouseenter:function(){if(J.data.overUnabb&&this.num>0){this.jqo.text(w.formatI(this.num,true))}},_mouseleave:function(){if(J.data.overUnabb){this.jqo.text(w.formatI(this.num))}}};var n=function(P,N){var Q=this,e=(this.jqo=P);this.onChange=N;e.change(function(){Q.set().onChange()});q('<option value="">-</option>').appendTo(e);var O=q('meta[name="ogame-planet-coordinates"]').attr("content").replace(/[^0-9\:]/g,"");var M=q('meta[name="ogame-planet-type"]').attr("content").toLowerCase().trim();q.each(q("#planetList").children("div").get(),function(R,S){var T=q(S),U=T.find(".planet-koords");if(U.get().length==0){return}U=U.text().replace(/[^0-9\:]/g,"");option=q('<option value="planet:'+U+'">['+U+"] "+T.find(".planet-name").text().trim()+"</option>").appendTo(e);if(U==O&&M=="planet"){Q._setCurrent(option)}if(T.find(".moonlink").get().length>0){option=q('<option value="moon:'+U+'">['+U+"] ("+t.MOON+")</option>").appendTo(e).addClass(G+"moon");if(U==O&&M=="moon"){Q._setCurrent(option)}}})};n.prototype={use:false,type:0,galaxy:0,system:0,planet:0,set:function(e){var M=((arguments.length>0)?e:this.jqo.val()).split(":");if(M.length<4){this.use=false}else{this.use=true;this.type=M.shift();this.galaxy=M.shift();this.system=M.shift();this.planet=M.shift()}return this},_setCurrent:function(e){e.addClass(G+"highlight").html(e.html()+" &laquo; "+t.CUR_PLA);if(J.data.selCurPla){e.attr("selected","selected")}this.current=e;this.set()},clickCurrent:function(){this.jqo.val(this.current.val()).change()}};var D=function(O,R,P){var M,e,Q=this,N;if(arguments.length<4){this.isNew=false;this.name=("name" in P)?P.name:(P.id=="MAX")?t.MAX:(P.id=="MIN")?t.MIN:t.REG;this.id=P.id;N=P.ratio}else{this.isNew=true;this.name="*"+t.NEW;N=J.getRatioById(P.defRatio,P).ratio}this.list=O;if(this.isLimit=/^MIN|MAX$/.test(this.id)){this.jqo=q(h.RATIO_LIST_LIMIT).appendTo(O.jqo);this.jqo.find("."+G+"name_noedit").text(this.name)}else{this.jqo=q(this.isNew?h.RATIO_LIST_NEW:h.RATIO_LIST_ITEM).appendTo(O.jqo);this.nameInput=this.jqo.find("."+G+"edit_ratio_name");this.nameInput.change(function(){Q.name=Q.nameInput.val().trim()}).keyup(function(){Q.nameInput.change()}).val(this.name)}this.posLabel=this.jqo.find("."+G+"pos");this.setPos(R);e=["met","cry","deu"];for(M in e){this[e[M]+"Input"]=new o(this.jqo.find("."+G+"edit_ratio_"+e[M]),N[M],"f",true,false,function(){Q.list.onChange()})}this.addButton=this.jqo.find("."+G+"icon_add").click(function(){var T=Q.list,S=new D(T,Q.pos,Q.getInfo());S.disableDown().jqo.after(Q.jqo);T.list[Q.pos]=S;T.list[Q.pos-1].enableDown();Q.nameInput.val(Q.name="*"+t.NEW);Q.setPos(++Q.pos)});this.upButton=this.jqo.find("."+G+"icon_up").click(function(){Q.move(true)});this.upDisabled=false;this.downButton=this.jqo.find("."+G+"icon_down").click(function(){Q.move(false)});this.downDisabled=false;this.trashButton=this.jqo.find("."+G+"icon_trash");if(this.isLimit){this.trashButton.addClass("disabled")}else{this.trashButton.click(function(){Q.remove()})}this.radio=this.jqo.find('input[name="'+G+'def_ratio"]').click(function(){Q.list.defRatio=Q.id});if(O.defRatio==this.id){this.radio.click()}this.legal=this.jqo.find("."+G+"legal")};D.prototype={getInfo:function(){var M=this,e={id:M.isNew?y():M.id,ratio:[M.metInput.num,M.cryInput.num,M.deuInput.num]};if((!M.isLimit)&&(M.isNew||M.id!="REG"||M.name!=t.REG)){e.name=M.name}return e},move:function(M){var N,e;if(M){if(this.upDisabled){return this}N=this.list.list[this.pos-1];this.jqo.after(N.jqo)}else{if(this.downDisabled){return this}N=this.list.list[this.pos+1];N.jqo.after(this.jqo)}e=this.pos;this.setPos(N.pos);N.setPos(e);e=N.upDisabled;if(this.upDisabled){N.disableUp()}else{N.enableUp()}if(e){this.disableUp()}else{this.enableUp()}e=N.downDisabled;if(this.downDisabled){N.disableDown()}else{N.enableDown()}if(e){this.disableDown()}else{this.enableDown()}this.list.sortList()},remove:function(){var N,e=[],O=this.list.list,M=this.list.newItem;this.jqo.remove();O.splice(this.pos,1);for(N=0;N<O.length;N++){e[N]=(O[N].setPos(N))}this.list.list=e;if(this.list.defRatio==this.id){e[0].radio.click()}if(this.downDisabled){e[e.length-1].disableDown()}if(this.upDisabled){e[0].disableUp()}M.setPos(M.pos-1)},enableUp:function(){this.upDisabled=false;this.upButton.removeClass("disabled");return this},enableDown:function(){this.downDisabled=false;this.downButton.removeClass("disabled");return this},disableUp:function(){this.upDisabled=true;this.upButton.addClass("disabled");return this},disableDown:function(){this.downDisabled=true;this.downButton.addClass("disabled");return this},setLegal:function(e){if(e){this.legal.text(t.YES).addClass("undermark").removeClass("overmark")}else{this.legal.text(t.NO).addClass("overmark").removeClass("undermark")}return this},setPos:function(e){if(e%2==0){this.jqo.addClass("alt")}else{this.jqo.removeClass("alt")}this.pos=e;this.posLabel.html(this.isNew?"+":e+1);return this}};var l={list:[],limits:[],clear:function(){for(var M in this.list){this.list[M].jqo.remove()}this.list=(this.limits=[]);try{this.newItem.jqo.remove()}catch(N){}},sortList:function(){this.list.sort(function(M,e){return M.pos-e.pos})},build:function(M){var O,P,N=(arguments.length>0)?M:J.data;this.clear();this.defRatio=N.defRatio;for(O=0;O<N.ratioList.length;O++){P=new D(this,O,N.ratioList[O]);this.list[O]=P;if(P.isLimit){this.limits[this.limits.length]=P}}var e=this.list.length;this.newItem=new D(this,e,N,true);this.list[0].disableUp();this.list[e-1].disableDown();this.onChange()},updateData:function(e){var N=(arguments.length>0)?e:J.data;N.ratioList=[];for(var M in this.list){N.ratioList[M]=this.list[M].getInfo()}N.defRatio=this.defRatio},onChangeItem:function(e){if(!e.isLimit){e.setLegal(x.isLegal(e.getInfo().ratio))}},onChange:function(){x.setLimits(this.limits[0].getInfo().ratio,this.limits[1].getInfo().ratio);for(var e=0;e<this.list.length;e++){this.onChangeItem(this.list[e])}this.onChangeItem(this.newItem)},init:function(e){this.jqo=e}};var i=function(M,Q,N,e,P){var O=this;this.list=M;this.iface=P;this.pos=Q;this.title=N.click(function(){O._click()});this.box=e;if(e.hasClass(G+"hidden")){this.setOpen(false)}else{this.setOpen(true)}};i.prototype={updateOpenCss:function(){this.openCss={height:this.box.height()+"px","padding-top":this.box.css("padding-top"),"padding-bottom":this.box.css("padding-bottom"),"margin-top":this.box.css("margin-top"),"margin-bottom":this.box.css("margin-bottom")};return this},closeCss:{height:0,"padding-top":0,"padding-bottom":0,"margin-top":0,"margin-bottom":0},afterOpenCss:{height:"auto"},duration:250,setOpen:function(e){if(this.isOpen=e){this.list.itemOpen=this}return this},open:function(){this.updateOpenCss().box.removeClass(G+"hidden");return this.setOpen(true)},close:function(){this.updateOpenCss().box.addClass(G+"hidden");return this.setOpen(false)},animateOpen:function(){var e=this.afterOpenCss;this.updateOpenCss().box.css(this.closeCss).removeClass(G+"hidden").animate(this.openCss,this.duration,function(){q(this).css(e)});return this.setOpen(true)},animateClose:function(){var e=this;this.updateOpenCss().box.css(this.openCss).animate(this.closeCss,this.duration,function(){q(this).addClass(G+"hidden").css(e.openCss).css(e.afterOpenCss)});return this.setOpen(false)},_click:function(){if(!this.isOpen){this.iface.clearExport();this.list.itemOpen.animateClose();this.animateOpen()}}};var F={init:function(N,O){this.jqo=N;var M,e=[];N.find("."+G+"config_title").each(function(P,Q){e[P]={title:q(Q)}});N.find("."+G+"config_box").each(function(P,Q){e[P].box=q(Q)});this.list=[];for(M=0;M<e.length;M++){this.list[M]=new i(this,M,e[M].title,e[M].box,O)}}};var k=({addCss:function(N){var M=L.createElement("style");M.setAttribute("type","text/css");if(M.styleSheet){M.styleSheet.cssText=N}else{M.appendChild(L.createTextNode(N))}var e=L.getElementsByTagName("head")[0];e.appendChild(M);return this},findIDP:function(e){return this.window.find("#"+G+e)},menuButton:null,menuButtonAction:function(){this.menuButtonAction=function(){};this.makeWindow()},makeMenuButton:function(){var e=this;this.menuButton=q(h.MENUBUTTON).appendTo(q("#menuTableTools")).find("#"+G+"menubutton").click(function(){e.menuButtonAction()});return e},window:null,ogameHide:null,isHidden:true,show:function(){this.isHidden=false;this.ogameHide.hide();this.window.show();return this},hide:function(){this.isHidden=true;this.window.hide();this.ogameHide.show();return this},toggle:function(){if(this.isHidden){return this.show()}return this.hide()},makePlanetSelect:function(){var e=this;e.planet=new n(e.findIDP("planet"),function(){e.onChange()});return e},makeActionSelect:function(){var e=this;e.actionJqo=e.findIDP("action").change(function(){e.action=q(this).val();e.onChange()}).val(e.action=J.data.defAction);return e},makeResourceInput:function(e,M){var N=this;N["input"+e.capitalize()]=new o(N.findIDP("input_"+e),M,"i",false,true,function(){N.checkOutputSelect().onChange()});return N},makeRatioSelect:function(){var e=this;this.ratioSelectJqo=e.findIDP("ratio").change(function(){var M=q(this).val().split(":");if(M.length>3){q(this).val("");e.ratioMet.set(parseFloat(M[1]));e.ratioCry.set(parseFloat(M[2]));e.ratioDeu.set(parseFloat(M[3]));e.checkRatio().onChange()}});return e.updateRatioSelect()},updateRatioSelect:function(){var M,e=this.ratioSelectJqo.html("").append(q('<option value="">-</option>'));for(M in J.data.ratioList){ratio=J.getRatio(M);e.append(q('<option value="'+ratio.val+'">'+w.formatF(ratio.met)+":"+w.formatF(ratio.cry)+":"+w.formatF(ratio.deu)+" ("+ratio.name+")</option>"))}return this},makeRatioInput:function(e,M){var N=this;N["ratio"+e.capitalize()]=new o(N.findIDP("ratio_"+e),M,"f",true,false,function(){N.checkRatio().onChange()});return N},checkRatio:function(){var e=this;if(A.isLegal(e.ratioMet.num,e.ratioCry.num,e.ratioDeu.num)){e.ratioIllegal.hide()}else{e.ratioIllegal.show()}return e},makePercentInput:function(e){var N=this,M="percent"+e.capitalize();N[M]=new o(N.findIDP("percent_"+e),0,"p",false,true,function(Q){if(Q.num>100){Q.set(100,true)}var O="percentMet",P;if(/Met|Cry/.test(M)&&(!N.percentDeu.isDisabled())){O="percentDeu"}else{if(/Met|Deu/.test(M)&&(!N.percentCry.isDisabled())){O="percentCry"}}P=parseFloat((100-Q.num).toFixed((Q.num+"").split(".").pop().length));N[O].set(P);N.onChange()});return N},checkOutputSelect:function(){var S=this,Q=S.outputJqo.val(),O=(S.inputMet.num>0),M=(S.inputCry.num>0),R=(S.inputDeu.num>0),P=/m/.test(Q),N=/c/.test(Q),e=/d/.test(Q);if(!O&&!M&&R&&!P&&!N&&e){S.changeOutputSelect("mc")}else{if(!O&&M&&!R&&!P&&N&&!e){S.changeOutputSelect("md")}else{if(O&&!M&&!R&&P&&!N&&!e){S.changeOutputSelect("cd")}else{if((!O&&M&&R)||P&&((M&&N)||(R&&e))){S.changeOutputSelect("m")}else{if((O&&!M&&R)||N&&((O&&P)||(R&&e))){S.changeOutputSelect("c")}else{if((O&&M&&!R)||e&&((O&&P)||(M&&N))){S.changeOutputSelect("d")}}}}}}return S},changeOutputSelect:function(e){this.outputJqo.val(e);m=this.percentMet.disable().set(0),c=this.percentCry.disable().set(0),d=this.percentDeu.disable().set(0);if(e=="m"){m.set(100)}else{if(e=="c"){c.set(100)}else{if(e=="d"){d.set(100)}else{if(e=="mc"){m.enable().set(50);c.enable().set(50)}else{if(e=="md"){m.enable().set(50);d.enable().set(50)}else{c.enable().set(50);d.enable().set(50)}}}}}return this},makeOutputSelect:function(){var e=this;this.outputJqo=e.findIDP("output").change(function(){e.changeOutputSelect(q(this).val());e.onChange()});return e},toggleConfigCalc:function(){this.window.toggleClass("config").toggleClass("calc");return this},updateConfigData:function(e){var N=this,M=(arguments.length>0)?e:J.data;l.updateData(M);M.defAction=N.defAction.val();M.defOutput=N.defOutput.val();M.selCurPla=N.selCurPla.val();M.abb=N.abb.val();M.overUnabb=N.overUnabb.val();M.millionAbb=N.millionAbb.val();M.millionKey=N.millionKey.val();M.thousandAbb=N.thousandAbb.val();M.thousandKey=N.thousandKey.val();M.messageTpl=N.messageTpl.val();return N},updateConfigIface:function(e){var N=this,M=(arguments.length>0)?e:J.data;x.setLimits(M);l.build(M);N.defAction.val(M.defAction);N.defOutput.val(M.defOutput);N.selCurPla.val(M.selCurPla);N.abb.val(M.abb);N.overUnabb.val(M.overUnabb);N.millionAbb.val(M.millionAbb);N.millionKey.val(M.millionKey);N.thousandAbb.val(M.thousandAbb);N.thousandKey.val(M.thousandKey);N.messageTpl.val(M.messageTpl);N.ieInput.val("");return N},updateCalcIface:function(){A.setLimits();this.inputMet.set(this.inputMet.num);this.inputCry.set(this.inputCry.num);this.inputDeu.set(this.inputDeu.num);this.updateRatioSelect().checkRatio().onChange();return this},makeConfigButtons:function(){var e=this;e.findIDP("config_but").click(function(){e.toggleConfigCalc()});e.findIDP("config_accept").click(function(){e.updateConfigData();J.save();e.updateCalcIface();e.toggleConfigCalc()});e.findIDP("config_cancel").click(function(){e.updateConfigIface();e.toggleConfigCalc()});e.findIDP("config_default").click(function(){J.remove();e.updateCalcIface();e.updateConfigIface();e.toggleConfigCalc()});return e},makeImportExport:function(){var e=this;e.ieInput=e.findIDP("ie_conf").focus(function(){q(this).select()});e.findIDP("ie_import").click(function(){try{var M=J.parseData(e.ieInput.val());e.updateConfigIface(M)}catch(N){alert(N)}});e.findIDP("ie_export").click(function(){var M=q.extend({},J.data);e.updateConfigData(M);e.ieInput.val("").val(JSON.stringify(M)).select()});return e},makeAbbKey:function(){var e=this;e.abb=new z(e.findIDP("abb"));e.overUnabb=new z(e.findIDP("overUnabb"));e.millionAbb=new g(e.findIDP("millionAbb"),J.data.millionAbb,J.abbRE,true,false);e.thousandAbb=new g(e.findIDP("thousandAbb"),J.data.thousandAbb,J.abbRE,true,false);e.millionKey=new g(e.findIDP("millionKey"),J.data.millionKey,J.keyRE,true,false);e.thousandKey=new g(e.findIDP("thousandKey"),J.data.thousandKey,J.keyRE,true,false);return e},makeMessageTpl:function(){var e=this;e.messageTpl=e.findIDP("messageTpl");e.findIDP("messageTpl_restore").click(function(){e.messageTpl.val(J.getDefaultData().messageTpl)});return e},clearExport:function(){this.ieInput.val("");return this},makeWindow:function(){h.init();J.load();A=new K();x=new K();var M=this,e=J.getRatioById(J.data.defRatio);M.ogameHide=q("#inhalt").after(this.window=q(h.WINDOW).hide());M.addCss(h.CSS).show();M.ratioIllegal=M.findIDP("ratio_illegal").hide();M.outputMessage=M.findIDP("message").click(function(){q(this).select()});M.outputMet=new b(M.findIDP("output_met"),0);M.outputCry=new b(M.findIDP("output_cry"),0);M.outputDeu=new b(M.findIDP("output_deu"),0);M.sendRes=new b(M.findIDP("sendRes"),0);M.sendLC=new b(M.findIDP("sendLC"),0);M.sendSC=new b(M.findIDP("sendSC"),0);M.receiveRes=new b(M.findIDP("receiveRes"),0);M.receiveLC=new b(M.findIDP("receiveLC"),0);M.receiveSC=new b(M.findIDP("receiveSC"),0);M.findIDP("close").click(function(){M.hide()});M.makeActionSelect().makeResourceInput("met",0).makeResourceInput("cry",0).makeResourceInput("deu",0).makeRatioSelect().makeRatioInput("met",e.met).makeRatioInput("cry",e.cry).makeRatioInput("deu",e.deu).makeOutputSelect().makePercentInput("met").makePercentInput("cry").makePercentInput("deu").changeOutputSelect(J.data.defOutput).makePlanetSelect().checkRatio();M.findIDP("selCurPla_button").click(function(){M.planet.clickCurrent()});M.menuButtonAction=function(){M.toggle()};M.makeImportExport();F.init(M.findIDP("config"),M);l.init(M.findIDP("ratioList"),this);M.defAction=M.findIDP("defAction");M.defOutput=M.findIDP("defOutput");M.selCurPla=new z(M.findIDP("selCurPla"));M.makeAbbKey().makeMessageTpl().makeConfigButtons().updateConfigIface();return M},onChange:function(){var M=this,e=f(M.inputMet.num,M.inputCry.num,M.inputDeu.num,M.ratioMet.num,M.ratioCry.num,M.ratioDeu.num,M.percentMet.num,M.percentCry.num,M.percentDeu.num);M.outputMet.val(e.met);M.outputCry.val(e.cry);M.outputDeu.val(e.deu);if(M.action=="buy"){M.sendRes.val(e.met+e.cry+e.deu);M.receiveRes.val(M.inputMet.num+M.inputCry.num+M.inputDeu.num)}else{M.receiveRes.val(e.met+e.cry+e.deu);M.sendRes.val(M.inputMet.num+M.inputCry.num+M.inputDeu.num)}M.sendLC.val(Math.ceil(M.sendRes.num/25000));M.sendSC.val(Math.ceil(M.sendRes.num/5000));M.receiveLC.val(Math.ceil(M.receiveRes.num/25000));M.receiveSC.val(Math.ceil(M.receiveRes.num/5000));M.outputMessage.text(E.make(M.action,{met:M.inputMet.txt,cry:M.inputCry.txt,deu:M.inputDeu.txt,},{met:M.outputMet.val(),cry:M.outputCry.val(),deu:M.outputDeu.val(),},{res:M.sendRes.val(),lc:M.sendLC.val(),sc:M.sendSC.val(),},{res:M.receiveRes.val(),lc:M.receiveLC.val(),sc:M.receiveSC.val(),},{met:M.ratioMet.txt,cry:M.ratioCry.txt,deu:M.ratioDeu.txt,},M.planet));return M},init:function(){return this.makeMenuButton()}}).init()})();