// ==UserScript==
// @name           OGame Trade Calculator
// @description    Adds a trade calculator to the OGame interface
// @namespace      http://userscripts.org/users/68563/scripts
// @downloadURL    https://userscripts.org/scripts/source/151002.user.js
// @updateURL      https://userscripts.org/scripts/source/151002.meta.js
// @version        2.2.1
// @include        *://*.ogame.*/game/index.php?*page=*
// ==/UserScript==
/*! OGame Trade Calculator (C) 2012 Elías Grande Cásedas | GNU-GPL | gnu.org/licenses */
(function(){var C,s={ID_PREFIX:(C="o_trade_calc_"),NAME:"OGame Trade Calculator",HOME_URL:"http://userscripts.org/scripts/show/151002",TESTED_OGAME_VERSION:"5.2.0-beta1"};var n=window,G,o;try{if(unsafeWindow){n=unsafeWindow}}catch(D){}G=n.document;o=n.jQuery;o.getScript("/cdn/js/greasemonkey/version-check.js",function(){n.oGameVersionCheck(s.NAME,s.TESTED_OGAME_VERSION,s.HOME_URL)});
/*! jCaret (C) 2010 C. F. Wong | cloudgen.w0ng.hk | www.opensource.org/licenses/mit-license.php */
(function(I,e,H,J){I.fn.caret=function(Y,U){var L,O,W=this[0],Q=I.browser.msie;if(typeof Y==="object"&&typeof Y.start==="number"&&typeof Y.end==="number"){L=Y.start;O=Y.end}else{if(typeof Y==="number"&&typeof U==="number"){L=Y;O=U}else{if(typeof Y==="string"){if((L=W.value.indexOf(Y))>-1){O=L+Y[e]}else{L=null}}else{if(Object.prototype.toString.call(Y)==="[object RegExp]"){var V=Y.exec(W.value);if(V!=null){L=V.index;O=L+V[0][e]}}}}}if(typeof L!="undefined"){if(Q){var R=this[0].createTextRange();R.collapse(true);R.moveStart("character",L);R.moveEnd("character",O-L);R.select()}else{this[0].selectionStart=L;this[0].selectionEnd=O}this[0].focus();return this}else{if(Q){var T=document.selection;if(this[0].tagName.toLowerCase()!="textarea"){var M=this.val(),P=T[H]()[J]();P.moveEnd("character",M[e]);var X=(P.text==""?M[e]:M.lastIndexOf(P.text));P=T[H]()[J]();P.moveStart("character",-M[e]);var S=P.text[e]}else{var P=T[H](),K=P[J]();K.moveToElementText(this[0]);K.setEndPoint("EndToEnd",P);var X=K.text[e]-P.text[e],S=X+P.text[e]}}else{var X=W.selectionStart,S=W.selectionEnd}var N=W.value.substring(X,S);return{start:X,end:S,text:N,replace:function(Z){return W.value.substring(0,X)+Z+W.value.substring(S,W.value[e])}}}}})(o,"length","createRange","duplicate");
/*! [/jCaret] */
String.prototype.replaceAll=function(e,H){return this.split(e).join(H)};String.prototype.recursiveReplaceMap=function(K,J,H){if(H==0){return this.split(K[0]).join(J[0])}var I,e=this.split(K[H]);for(I in e){e[I]=e[I].recursiveReplaceMap(K,J,H-1)}return e.join(J[H])};String.prototype.replaceMap=function(e){var H,K,J,I;K=new Array();J=new Array();I=0;for(H in e){K.push(H);J.push(e[H]);I++}if(I==0){return this}else{return this.recursiveReplaceMap(K,J,I-1)}};String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")};var h=({getMeta:function(H,I){try{return o('meta[name="'+H+'"]').attr("content")}catch(J){if(arguments.length>1){return I}else{return null}}},getResource:function(I){var e={NAME:"",AMOUNT:0,getName:function(K){var J=this.NAME+"";h[K]=this.AMOUNT+0;return J}};var H=o("#"+I).attr("title");e.NAME=H.split(":").shift();e.AMOUNT=parseInt(H.split("/tr").shift().replace(/\D/g,""));return e},init:function(){return{LANGUAGE:this.getMeta("ogame-language",""),RES_MET:this.getResource("metal_box"),RES_CRY:this.getResource("crystal_box"),RES_DEU:this.getResource("deuterium_box")}}}).init();var p={
/*! [colors] */
MET:"#FF7700",CRY:"#00FFFF",DEU:"#FF33FF"
/*! [/colors] */
};var q=({text:{RES_MET:h.RES_MET.getName("RES_MET"),RES_CRY:h.RES_CRY.getName("RES_CRY"),RES_DEU:h.RES_DEU.getName("RES_DEU")},set:function(e,H){if(e.test(h.LANGUAGE)){o.extend(true,this.text,H)}return this}}
/*! [i18n=en] */
).set(/.*/,{THO_SEP:",",DEC_SEP:".",MENU:"Trace C.",TITLE:"Trade calculator",ACTION:"Action",BUY:"I buy",SELL:"I sell",RATIO:"Ratio",ILLEGAL:"illegal",IN_EXCH:"In exchange for",RESULT:"Result",MESSAGE:"Message",WHERE:"Place of delivery",PLANET:"Planet",MOON:"Moon",CUR_PLA:"Current planet",MAX:"Maximum",REG:"Regular",MIN:"Minimum",RAT_LST:"Ratio list",NAME:"Name",LEGAL:"Legal",YES:"Yes",NO:"No",DEFAULT:"Default",NEW:"New",IE_CONF:"Import / Export configuration",IMPORT:"Import",EXPORT:"Export",ACCEPT:"Accept",CANCEL:"Cancel",RES_DEF:"Restore default settings"}
/*! [i18n=es] */
).set(/es|ar|mx/,{THO_SEP:".",DEC_SEP:",",MENU:"C. Comercio",TITLE:"Calculadora de comercio",ACTION:"Acción",BUY:"Compro",SELL:"Vendo",RATIO:"Ratio",ILLEGAL:"ilegal",IN_EXCH:"A cambio de",RESULT:"Resultado",MESSAGE:"Mensaje",WHERE:"Lugar de entrega",PLANET:"Planeta",MOON:"Luna",CUR_PLA:"Planeta actual",MAX:"Máximo",REG:"Normal",MIN:"Mínimo",RAT_LST:"Lista de ratios",NAME:"Nombre",LEGAL:"Legal",YES:"Si",NO:"No",DEFAULT:"Por defecto",NEW:"Nuevo",IE_CONF:"Importar / Exportar configuración",IMPORT:"Importar",EXPORT:"Exportar",ACCEPT:"Aceptar",CANCEL:"Cancelar",RES_DEF:"Restaurar ajustes por defecto"}
/*! [/i18n] */
).text;var f={
/*! [css] */
CSS:"#"+C+"window{float:left;position:relative;width:670px;overflow:visible;z-index:2;}#galaxy #"+C+"window{top:-44px;}#"+C+'header{height:28px;position: relative;background: url("http://gf1.geo.gfsrv.net/cdn63/10e31cd5234445e4084558ea3506ea.gif") no-repeat scroll 0px 0px transparent;}#'+C+"header h4{height:28px;line-height:28px;text-align:center;color:#6F9FC8;font-size:12px;font-weight:bold;position:absolute;top:0;left:100px;right:100px;}#"+C+"config_but{display:block;height:16px;width:16px;background:url(http://gf3.geo.gfsrv.net/cdne7/1f57d944fff38ee51d49c027f574ef.gif);float:right;margin:8px 0 0 0;opacity:0.5;}#"+C+"config_but:hover{opacity:1;}#"+C+'window.config input[type="button"]{margin:0 5px 0 5px;}#'+C+"window.config #"+C+"config_but{display:none;}#"+C+"config,#"+C+"window.config #"+C+"calc{display:none;}#"+C+"window.config #"+C+"config{display:block;}#"+C+'main{padding:15px 25px 0 25px;background: url("http://gf1.geo.gfsrv.net/cdn9e/4f73643e86a952be4aed7fdd61805a.gif") repeat-y scroll 5px 0px transparent;}#'+C+"main *{font-size:11px;}#"+C+"window table{width:620px;background-color:#0D1014;border-collapse:collapse;clear:both;}#"+C+"window.config table{width:598px;}#"+C+"main th{color:#6F9FC8;text-align:center;font-weight:bold;}."+C+"label,."+C+"label *{color:grey;text-align:left;}."+C+"label{padding:0 5px 0 5px;font-weight:bold;}#"+C+"window.config ."+C+"label{text-align:center;}#"+C+"main tr,#"+C+"main td,#"+C+"main th{height:28px;line-height:28px;}#"+C+'main input[type="text"]{width:100px;text-align:center;}option.'+C+"highlight{color:lime !important;font-weight:bold;}option."+C+"moon{color:orange;}."+C+"select{width:150px;text-align:left;}."+C+"select select{width:130px;text-align:center;}#"+C+"main option{padding:1px 5px 1px 5px;}."+C+"input{width:112px;padding:0 1px 0 1px;text-align:right;}."+C+"name{width:142px;padding:0 1px 0 1px;text-align:right;}#"+C+"main ."+C+"name input{width:130px;text-align:center;}."+C+"ratio{width:82px;padding:0 1px 0 1px;text-align:right;}#"+C+"main ."+C+"ratio input{width:70px;text-align:center;}#"+C+"ratio_illegal{color:red;}."+C+"output{width:108px;text-align:center;font-weight:bold;}#"+C+"output_met{color:"+p.MET+";}#"+C+"output_cry{color:"+p.CRY+";}#"+C+"output_deu{color:"+p.DEU+";}."+C+"textarea{padding:0 3px 0 3px !important;}#"+C+"message{width:601px;height:50px !important;margin:0 !important;}#"+C+"planet{width:auto;text-align:left;margin:0;}."+C+"select1row select{width:auto;text-align:left;margin:0;}#"+C+'footer{height:17px;background: url("http://gf1.geo.gfsrv.net/cdn30/aa3e8edec0a2681915b3c9c6795e6f.gif") no-repeat scroll 2px 0px transparent;}.'+C+'config_title{font-size:11px;font-weight:bold;color:#6F9FC8;line-height:22px;background:url("http://gf1.geo.gfsrv.net/cdn0b/d55059f8c9bab5ebf9e8a3563f26d1.gif") no-repeat scroll 0 0 #13181D;height:22px;margin:0 0 10px 0;padding:0 0 0 40px;border:1px solid #000;overflow:hidden;cursor:pointer;}.'+C+"config_title:hover{color:#A7AFB7;background-color:#23282D;border-color:#13181D;}."+C+"config_box{border:1px solid #000;margin:5px 5px 10px 5px;padding:5px;}#"+C+"new_ratio input{border-color:#9C0;}."+C+"check,."+C+"name_noedit{text-align:center;}."+C+"check input{vertical-align:text-bottom;}."+C+'check input[type="checkbox"]{vertical-align:middle;}.'+C+"action{text-align:center;padding:0 3px 0 3px;}."+C+'action a{background:url("http://gf1.geo.gfsrv.net/cdn94/297ee218d94064df0a66bd41a04d28.png") scroll 0 0 no-repeat;width:16px;height:16px;display:inline-block;vertical-align:top;position:relative;top:5px;border:1px solid #000;border-radius:2px;opacity:0.7;}a.'+C+"icon_up,a."+C+"icon_down,a."+C+"icon_add{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAwCAMAAAAvgQplAAAAAXNSR0IArs4c6QAAAvpQTFRFbomeXHaLb4mdgpyveJaxdpSweZKk////W3qXVnKNRWB6AAAANTU1PT09MUJTJzVD/6gAzAAA/9IA/wAAqsrjvtjrna25PlVsTWiCqbjESGF6YHyaOk9ldZOwTWeCPj4+PlRsVHeYRGKBUXCRQVx6VnibTGmFVnmbRWOERWSEXn+chJusPVhzU3SVQ19+TGyKU3aXPVRrTGqHkrHKPVZwUW6KQ2GAU3aZO09lcJCqYHqORV95UW6LTGeBQFlySGB5SmF6Q2B+VnmaUG2JVnSQS2qHSmeCL0RaXHmUU3WVoLzSqcTYQ2GCPFZxPVZxkaa1RWSDPFZyRl96XH2ZTGqGS2qJO1Ru1d7lV3SROk5kQVp0QVpz5erua4OWqLnGpcDUWn2ewMzVlK/EqLbCcY+qj6zESmF3r7zHob3TTGaAlqi2haO9XniNQ115TWiD8vX4k7DGZ4mqyNTdSmaBpcHWcImdjaKynbrRdY6hvMnTSWeHYXyaq7jDV3SQ6+/zo7/Ur8rd8PP1javGhaK82uLmq8bZq7vHh6a+0NrgnLjOhJqqUG+QpL/VsL7JdJOuXnmSytTcj6OxT2qE+Pn7eZm0zCszfZmxhqXBdZGpXHaOS2uKboynr73J4ebrhKO7obLAmLfR+vv9nLfNip+uX3yYXn+bdoyec42gobC9pbS/yNPbYX2aPVRtt8XPmLTLbo2odI2geI2fVHKT2OHo3OLoRGGBRmODkK7HaImkaomka4unjaCw/f7/mbjRXnyXd4+jf5Wmp8HWjq3IiqnEeZOqPlVtVHeXYH2ai6CxYYCbZIKfZn+TTGeDVnWQb5GtVnWRSWWASmWATGuKc5CpusXOU3GQlLPMXHqXUnSUZoSifJq0fJu3ZHyT/v//dpOwqcXZYHqSYnuQ7fDz7PD0XHyYWnaRkKW1TGiFTGmEj6zDYXuPPFdzPVdzrsndhpytVHaYh52uXn6c8PP2jqzFQFt5jKvFcYqeQl99gZ+52uHmRGKAyNTcV3iaqsbZDVW+rgAAAAF0Uk5TAEDm2GYAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3AsJFTcNV6u1fQAAAE9JREFUKM/dkjEOACAIA6tL//9jFaORqhtxsBO9CS4AyQXSKwkEpAfkIMgttNh4AUtCALQ/9NGPu4A87/erj/6DD30HBZuPwztsPmIFqY8CjdEFo21taJsAAAAASUVORK5CYII=);}a."+C+"icon_down{background-position:0px -16px}a."+C+"icon_add{background-position:0px -32px}."+C+"action a:hover{opacity:1;border-color:#08090b;}."+C+"action a.disabled,."+C+"action aldisabled:hover{opacity:0.1;cursor:default;}a."+C+"icon_trash{background-position:0px -304px}#"+C+"window.config .undermark,#"+C+"window.config .overmark{font-weight:bold;text-align:center;}#"+C+"ie_conf{display:block;width:586px;margin:0 0 5px 0;}."+C+"ie_conf{text-align:center}."+C+"hidden{position:fixed;left:-10000px;}",
/*! [tpl=window] */
WINDOW:'<div id="'+C+'window" class="calc"><div id="'+C+'header"><h4>'+q.TITLE+'</h4><a id="'+C+'close" href="javascript:void(0);" class="close_details close_ressources"></a><a id="'+C+'config_but" href="javascript:void(0);"></a></div><div id="'+C+'main"><div id="'+C+'calc"><table cellspacing="0" cellpadding="0"><tbody><tr><th colspan="2"></th><th>'+q.RES_MET+"</th><th>"+q.RES_CRY+"</th><th>"+q.RES_DEU+'</th></tr><tr class="alt"><td class="'+C+'label">'+q.ACTION+'</td><td class="'+C+'select"><select id="'+C+'action"><option value="sell">'+q.SELL+'</option><option value="buy">'+q.BUY+'</option></select></td><td class="'+C+'input"><input id="'+C+'input_met" type="text" value=""></td><td class="'+C+'input"><input id="'+C+'input_cry" type="text" value=""></td><td class="'+C+'input"><input id="'+C+'input_deu" type="text" value=""></td></tr><tr><td class="'+C+'label">'+q.RATIO+'<span id="'+C+'ratio_illegal"> ('+q.ILLEGAL+')</span></td><td class="'+C+'select"><select id="'+C+'ratio"></select></td><td class="'+C+'input"><input id="'+C+'ratio_met" type="text" value=""></td><td class="'+C+'input"><input id="'+C+'ratio_cry" type="text" value=""></td><td class="'+C+'input"><input id="'+C+'ratio_deu" type="text" value=""></td></tr><tr class="alt"><td class="'+C+'label">'+q.IN_EXCH+'</td><td class="'+C+'select"><select id="'+C+'output"><option value="m">'+q.RES_MET+'</option><option value="c">'+q.RES_CRY+'</option><option value="d">'+q.RES_DEU+'</option><option value="mc">'+q.RES_MET+" + "+q.RES_CRY+'</option><option value="md">'+q.RES_MET+" + "+q.RES_DEU+'</option><option value="cd">'+q.RES_CRY+" + "+q.RES_DEU+'</option></select></td><td class="'+C+'input"><input id="'+C+'percent_met" type="text" value=""></td><td class="'+C+'input"><input id="'+C+'percent_cry" type="text" value=""></td><td class="'+C+'input"><input id="'+C+'percent_deu" type="text" value=""></td></tr><tr><td class="'+C+'label" colspan="2">'+q.RESULT+'</td><td class="'+C+'output" id="'+C+'output_met"></td><td class="'+C+'output" id="'+C+'output_cry"></td><td class="'+C+'output" id="'+C+'output_deu"></td></tr><tr><td colspan="5">&nbsp;</td></tr><tr class="alt"><td class="'+C+'label" colspan="5">'+q.PLANET+'</td></tr><tr class="alt"><td class="'+C+'select1row" colspan="5"><select id="'+C+'planet"></select></td></tr><tr><td colspan="5">&nbsp;</td></tr><tr class="alt"><td class="'+C+'label" colspan="5">'+q.MESSAGE+'</td></tr><tr class="alt"><td class="'+C+'textarea" colspan="5"><textarea id="'+C+'message" cols="1" rows="1" readonly="readonly"></textarea></td></tr></tbody></table></div><div id="'+C+'config"><div class="'+C+'config_title">'+q.RAT_LST+'</div><div class="'+C+'config_box"><table cellspacing="0" cellpadding="0"><tbody id="'+C+'ratio_list"><tr><th>#</th><th>'+q.NAME+"</th><th>"+q.RES_MET+"</th><th>"+q.RES_CRY+"</th><th>"+q.RES_DEU+"</th><th>"+q.ACTION+"</th><th>"+q.LEGAL+"</th><th>"+q.DEFAULT+'</th></tr></tbody></table></div><div class="'+C+'config_title">'+q.IE_CONF+'</div><div class="'+C+"config_box "+C+"ie_conf "+C+'hidden"><textarea id="'+C+'ie_conf"></textarea><input id="'+C+'ie_import" type="button" value="'+q.IMPORT+'" class="btn_blue"><input id="'+C+'ie_export" type="button" value="'+q.EXPORT+'" class="btn_blue"></div><div class="textCenter"><input id="'+C+'config_accept" type="button" value="'+q.ACCEPT+'" class="btn_blue"><input id="'+C+'config_cancel" type="button" value="'+q.CANCEL+'" class="btn_blue"><input id="'+C+'config_default" type="button" value="'+q.RES_DEF+'" class="btn_blue"></div></div></div><div id="'+C+'footer"></div></div>',
/*! [tpl=button] */
MENUBUTTON:'<li><a id="'+C+'menubutton" class="menubutton" href="javascript:void(0)" accesskey="" target="_self"><span class="textlabel">'+q.MENU+"</span></a></li>",
/*! [tpl=ratio_list_limit] */
RATIO_LIST_LIMIT:'<tr><td class="'+C+"label "+C+'pos"></td><td class="'+C+'name_noedit"></td><td class="'+C+'ratio"><input class="'+C+'edit_ratio_met" type="text" /></td><td class="'+C+'ratio"><input class="'+C+'edit_ratio_cry" type="text" /></td><td class="'+C+'ratio"><input class="'+C+'edit_ratio_deu" type="text" /></td><td class="'+C+'action"><a href="javascript:void(0)" class="'+C+'icon_up"></a><a href="javascript:void(0)" class="'+C+'icon_down"></a><a href="javascript:void(0)" class="'+C+'icon_trash disabled"></a></td><td class="'+C+'label">-</td><td class="'+C+'check"><input name="'+C+'def_ratio" type="radio" /></td></tr>',
/*! [tpl=ratio_list_item] */
RATIO_LIST_ITEM:'<tr><td class="'+C+"label "+C+'pos"></td><td class="'+C+'name"><input class="'+C+'edit_ratio_name" type="text" /></td><td class="'+C+'ratio"><input class="'+C+'edit_ratio_met" type="text" /></td><td class="'+C+'ratio"><input class="'+C+'edit_ratio_cry" type="text" /></td><td class="'+C+'ratio"><input class="'+C+'edit_ratio_deu" type="text" /></td><td class="'+C+'action"><a href="javascript:void(0)" class="'+C+'icon_up"></a><a href="javascript:void(0)" class="'+C+'icon_down"></a><a href="javascript:void(0)" class="'+C+'icon_trash"></a></td><td class="'+C+'legal"></td><td class="'+C+'check"><input name="'+C+'def_ratio" type="radio" /></td></tr>',
/*! [tpl=ratio_list_new] */
RATIO_LIST_NEW:'<tr id="'+C+'new_ratio"><td class="undermark '+C+'pos"></td><td class="'+C+'name"><input class="'+C+'edit_ratio_name" type="text" /></td><td class="'+C+'ratio"><input class="'+C+'edit_ratio_met" type="text" /></td><td class="'+C+'ratio"><input class="'+C+'edit_ratio_cry" type="text" /></td><td class="'+C+'ratio"><input class="'+C+'edit_ratio_deu" type="text" /></td><td class="'+C+'action"><a href="javascript:void(0)" class="'+C+'icon_add"></a></td><td class="'+C+'legal"></td><td class="'+C+'label">-</td></tr>',
/*! [/tpl] */
};var x=(function(){var e=o('meta[name="ogame-universe"]').attr("content");
/*! [default_ratios] */
return/^\w+\.ogame\.org$/.test(e)?[3,2,1,2,1,1,3,2,1]:[5,3,1,2,1.5,1,3,2,1];
/*! [/default_ratios] */
})();var v=function(){return(new Date()).getTime()};var a=function(){};var r=function(H){H.preventDefault()};var E={DEFAULT_DATA:{
/*! [config=default] */
defAction:"sell",ratioList:[{id:"MAX",ratio:[x[0],x[1],x[2]]},{id:"MIN",ratio:[x[3],x[4],x[5]]},{id:"REG",ratio:[x[6],x[7],x[8]]}],defRatio:"REG",defOutput:"m",millionAbb:"M",millionKey:"m",thousandAbb:"K",thousandKey:"k",abb:false,overUnabb:false,messageTpl:"[b]{?b}{I18N.BUY}{/b}{?s}{I18N.SELL}{/s}:[/b] {?m}[b][color={COLOR.MET}]{m}[/color][/b] ({I18N.RES_MET}){?cd} + {/cd}{/m}{?c}[b][color={COLOR.CRY}]{c}[/color][/b] ({I18N.RES_CRY}){?d} + {/d}{/c}{?d}[b][color={COLOR.DEU}]{d}[/color][/b] ({I18N.RES_DEU}){/d}\n[b]{I18N.IN_EXCH}:[/b] {?M}[b][color={COLOR.MET}]{M}[/color][/b] ({I18N.RES_MET}){?CD} + {/CD}{/M}{?C}[b][color={COLOR.CRY}]{C}[/color][/b] ({I18N.RES_CRY}){?D} + {/D}{/C}{?D}[b][color={COLOR.DEU}]{D}[/color][/b] ({I18N.RES_DEU}){/D}\n\n[b]* {I18N.RATIO}:[/b] {rm}:{rc}:{rd}{?w}\n[b]* {I18N.WHERE}:[/b] {wg}:{ws}:{wp} ({wt}){/w}\n\n[b][url={SCRIPT.HOME_URL}]{SCRIPT.NAME}[/url][/b]"
/*! [/config] */
},_error:function(e){throw"DataError: "+e},_errorUndefined:function(e){this._error(e+" is undefined")},_errorExpected:function(e,H,I,J){var K;if(/^[\<\>]\d+$/.test(I)){if(I.charAt(0)==">"){K="greater"}else{K="less"}K+=" than "+I.slice(1)}else{K='"'+I.split(":").join(" or ")+'"'}this._error(e+": "+H+" "+K+' expected but "'+J+'" found')},_errorType:function(e,H,I){if(I=="undefined"){this._errorUndefined(e)}else{this._errorExpected(e,"type",H,I)}},_errorValue:function(e,H,I){this._errorExpected(e,"value",H,I)},_errorLength:function(e,H,I){this._errorExpected(e,"length",H,I)},parseData:function(M){var J,H,L,N=(typeof(M)=="string")?JSON.parse(M):M;if((L=typeof(N.defAction))!="string"){this._errorType("defAction","string",L)}if(typeof(N.ratioList)=="undefined"){this._errorUndefined("ratioList")}if(!(/^sell|buy$/.test(N.defAction))){this._errorValue("defAction","sell:buy",N.defAction)}L=typeof(N.defRatio);if(!(/^number|string$/.test(L))){this._errorType("defRatio","string:number",L)}var I=true,K=true,e=true;for(J=0;J<N.ratioList.length;J++){H=N.ratioList[J];if((L=H.ratio.length)!=3){this._errorLength("ratioList["+J+"]",3,L)}if((H.ratio[0]+=0)<=0){this._errorValue("ratioList["+J+"].ratio[0]",">0",H.ratio[0])}if((H.ratio[1]+=0)<=0){this._errorValue("ratioList["+J+"].ratio[1]",">0",H.ratio[1])}if((H.ratio[2]+=0)<=0){this._errorValue("ratioList["+J+"].ratio[2]",">0",H.ratio[2])}if(H.id==N.defRatio){e=false}if(/^MAX|MIN|REG$/.test(H.id+"")){if(H.id=="MAX"){I=false}else{if(H.id=="MIN"){K=false}}}else{if((L=typeof(H.id))!="number"){this._errorType("ratioList["+J+"].id","number",L)}if((L=typeof(H.name))!="string"){this._errorType("ratioList["+J+"].name","string",L)}}}if(I){this._error('ratioList: maximum ratio (id="MAX") not found')}if(K){this._error('ratioList: minimum ratio (id="MIN") not found')}if(e){this._error('ratioList: default ratio (id="'+N.defRatio+'" == defRatio) not found')}H=N.ratioList.slice(0).sort();for(J=1;J<H.length;J++){if(H[J-1].id==H[J].id){this._error('ratioList: duplicate id "'+H[J].id+'" found')}}if(!(/^m|c|d|mc|md|cd$/.test(N.defOutput))){this._errorValue("defOutput","m:c:d:mc:md:cd",N.defOutput)}if((L=typeof(N.millionAbb))!="string"){this._errorType("millionAbb","string",L)}if((L=N.millionAbb.length)<1){this._errorLength("millionAbb",">0",L)}if((L=typeof(N.millionKey))!="string"){this._errorType("millionKey","string",L)}if((L=N.millionKey.length)!=1){this._errorLength("millionKey",1,L)}if((L=typeof(N.thousandAbb))!="string"){this._errorType("thousandAbb","string",L)}if((L=N.thousandAbb.length)<1){this._errorLength("thousandAbb",">0",L)}if((L=typeof(N.thousandKey))!="string"){this._errorType("thousandKey","string",L)}if((L=N.thousandKey.length)!=1){this._errorLength("thousandKey",1,L)}if((L=typeof(N.abb))!="boolean"){this._errorType("abb","boolean",L)}if((L=typeof(N.overUnabb))!="boolean"){this._errorType("overUnabb","boolean",L)}if((L=typeof(N.messageTpl))!="string"){this._errorType("messageTpl","string",L)}return N},getRatio:function(H,K){var J=(arguments.length>1)?K.ratioList[H]:this.data.ratioList[H],L=J.id+"",e,I=J.ratio.slice(0);if("name" in J){e=J.name+""}else{e=q[L]}return{id:L,ratio:I,name:e,val:L+":"+I[0]+":"+I[1]+":"+I[2],met:I[0],cry:I[1],deu:I[2]}},getRatioById:function(K,I){var e,J=(arguments.length>1)?I:this.data,H=J.ratioList;for(e in H){if(H[e].id==K){return this.getRatio(e,J)}}return null},save:function(e){if(arguments.length>0){this.data=e}n.localStorage.setItem(C+"config",JSON.stringify(this.data));return this},load:function(){var e=n.localStorage.getItem(C+"config");if(e==null){this.data=this.DEFAULT_DATA}else{this.data=JSON.parse(e)}return this},remove:function(){n.localStorage.removeItem(C+"config");this.data=this.DEFAULT_DATA}};var t={formatI:function(K,I){var J,e=(arguments.length>1&&I);if(e&&K==""){return""}if(typeof(K)=="string"){J=("0"+K+"").replace(new RegExp(E.data.thousandKey+"$","i"),"000").replace(new RegExp(E.data.millionKey+"$","i"),"000000").replace(/\D/g,"").replace(/^0+(\d)/,"$1")}else{J=K.toFixed()+""}var H=/(\d+)(\d{3})/;while(H.test(J)){J=J.replace(H,"$1"+q.THO_SEP+"$2")}if(!e&&E.data.abb){return J.replace(/\D000\D000$/,E.data.millionAbb).replace(/\D(\d*[1-9]+)0*\D000$/,q.DEC_SEP+"$1"+E.data.millionAbb).replace(/\D000$/,E.data.thousandAbb)}return J},formatF:function(N,L){var M,e,K,I,H=(arguments.length>1&&L);if(H&&N==""){return""}if(typeof(N)=="string"){M=("0"+N+"").replace(/[\.\,]$/,q.DEC_SEP).replace(new RegExp("[^0-9\\"+q.DEC_SEP+"]","g"),"").replace(/^0+(\d)/,"$1")}else{M=(N+"").replace(".",q.DEC_SEP)}e=M.split(q.DEC_SEP);K=e[0];I=e.length>1?q.DEC_SEP+e[1]:"";if(M[M.length-1]==q.DEC_SEP&&H){I=q.DEC_SEP}var J=/(\d+)(\d{3})/;while(J.test(K)){K=K.replace(J,"$1"+q.THO_SEP+"$2")}return K+I},parseI:function(H){var e=t.parseF(H);if(new RegExp(E.data.thousandAbb+"$","i").test(H)){e=e*1000}else{if(new RegExp(E.data.millionAbb+"$","i").test(H)){e=e*1000000}}return Math.round(e)},parseF:function(e){return parseFloat(e.replaceAll(q.THO_SEP,"").replace(q.DEC_SEP,".").replace(/[^\d\.]/g,""))}};var F=function(){if(arguments.length<1){this.setLimits()}else{if(arguments.length<2){this.setLimits(arguments[0])}else{this.setLimits(arguments[0],arguments[1])}}};F.prototype={limits:[],isLegal:function(){var I;if(arguments.length==1){I=arguments[0]}else{I=[arguments[0],arguments[1],arguments[2]]}var H=I[0]/I[1],e=0;if(H<this.limits[e++]||H>this.limits[e++]){return false}H=I[0]/I[2];if(H<this.limits[e++]||H>this.limits[e++]){return false}H=I[1]/I[2];if(H<this.limits[e++]||H>this.limits[e++]){return false}return true},setLimits:function(J,I){if(arguments.length<2){var N,M,K,L=(arguments.length>0)?J.ratioList:E.data.ratioList;for(K in L){if(L[K].id=="MAX"){N=L[K].ratio}else{if(L[K].id=="MIN"){M=L[K].ratio}}}return this.setLimits(N,M)}this.limits=[];var H=J[0]/J[1],e=I[0]/I[1];this.limits.push(Math.min(H,e));this.limits.push(Math.max(H,e));H=J[0]/J[2];e=I[0]/I[2];this.limits.push(Math.min(H,e));this.limits.push(Math.max(H,e));H=J[1]/J[2];e=I[1]/I[2];this.limits.push(Math.min(H,e));this.limits.push(Math.max(H,e));return this}};var w,u;var b=function(K,L,J,N,O,M,H,I,e){return{met:Math.round(((K+(L/O)*N+(J/M)*N)/100)*H),cry:Math.round((((K/N)*O+L+(J/M)*O)/100)*I),deu:Math.round((((K/N)*M+(L/O)*M+J)/100)*e)}};var A={parseIf:function(M,N,e){var O="{?"+N+"}",J="{/"+N+"}";if(e){return M.split(O).join("").split(J).join("")}var L,K,H,I=M;while((L=I.indexOf(O))>=0&&(K=I.indexOf(J))>=0&&L<K){I=I.split(O);for(L=1;L<I.length;L++){H=I[L].split(J);if(H.length>1){H.shift();I[L]=J+H.shift()+H.join(J)}}I=I.join(O).split(O+J).join("")}return I},parseIfs:function(L,P){var K=L+"",J=L+"",R=/\{\?(\!?\w)+\}/,N,Q,O,I,H;while(R.test(K)){N=(R.exec(K)+"").replace(/\}.*$/,"").replace(/^.*\{/,"");K=K.split("{"+N+"}").join("");try{N=N.replace(/[^\w\!]/g,"");if((H=N[O=0])=="!"){Q=!P[++O]}else{Q=P[H]}I=N.length-1;Q=P[N[O]];while(O<I){if((H=N[++O])=="!"){Q=(Q||!P[++O])}else{Q=(Q||P[H])}}J=this.parseIf(J,N,Q)}catch(M){alert(M)}}return J},make:function(N,I,H,M,e){var K,L=/[1-9]/,J=this.parseIfs(E.data.messageTpl,{b:(N=="buy"),s:(N=="sell"),m:L.test(I.met),c:L.test(I.cry),d:L.test(I.deu),M:L.test(H.met),C:L.test(H.cry),D:L.test(H.deu),w:e.use});J=J.replaceMap({"{m}":I.met,"{c}":I.cry,"{d}":I.deu,"{M}":H.met,"{C}":H.cry,"{D}":H.deu,"{rm}":M.met,"{rc}":M.cry,"{rd}":M.deu,"{wg}":e.galaxy,"{ws}":e.system,"{wp}":e.planet,"{wt}":e.use?"{I18N."+(e.type+"").toUpperCase()+"}":0});for(K in q){J=J.replaceAll("{I18N."+K+"}",q[K])}for(K in s){J=J.replaceAll("{SCRIPT."+K+"}",s[K])}for(K in p){J=J.replaceAll("{COLOR."+K+"}",p[K])}return J}};var y=function(H,e){this.jqo=H;if(arguments.length>1){this.set(e)}};y.prototype={set:function(e){this.jqo.val(e);return this},disable:function(){this.jqo.attr("disabled","disabled").prop("disabled",true);return this},enable:function(){this.jqo.prop("disabled",false).removeAttr("disabled");return this},isDisabled:function(){return(this.jqo.attr("disabled")=="disabled")}};var l=function(M,L,K,J){var N=this,e=(this.jqo=M),I,H=K;this.allow0=true;this.focused=false;this.onChange=a;this.clearOnFocus=J;H=K.substring(0,1).toUpperCase();if(this.typePercent=(H=="P")){H="F"}this.formatFunc=t["format"+H];this.parseFunc=t["parse"+H];if(arguments.length>4){if(arguments.length>5){this.allow0=arguments[4];this.onChange=arguments[5]}else{if(typeof(arguments[4])=="function"){this.onChange=arguments[4]}else{this.allow0=(arguments[4]&&true)}}}this.set(L);I=function(){var S=N.jqo,Q=S.val(),R=S.caret(),O=Q.length,T=O-R.start,P=O-R.end;Q=N.formatFunc(S.val(),true);O=Q.length;T=Math.max(Math.min(O-T,O),0);P=Math.max(Math.min(O-P,O),0);num=(Q=="")?0:N.parseFunc(Q);if(N.allow0||num>0){N.set(Q,true).onChange(N)}S.caret(T,P)};e.keyup(function(O){if(!(/^9|16$/.test(O.which+""))){I()}}).change(I).blur(function(){N.set(N.num);N.focused=false}).focus(function(){N.focused=true;var Q=o(this);if(N.clearOnFocus||N.num==0){Q.val("")}else{var P=Q.caret(),O=Q.val().length;Q.val(N.formatFunc(N.num,true));if(P.end==O){if(P.start==O){P.start=(--P.end)}else{P.end--}}O=Q.val().length;Q.caret(Math.min(Math.max(0,P.start),O),Math.min(Math.max(0,P.end),O))}}).mouseenter(function(){if(E.data.overUnabb&&!(N.typePercent||N.focused||N.clearOnFocus)){var O=N.jqo;O.val(N.formatFunc(N.num,true));if(O.val()==""){O.val(0)}}}).mouseleave(function(){if(E.data.overUnabb&&!(N.typePercent||N.focused||N.clearOnFocus)){N.jqo.val(N.txt)}})};l.prototype=o.extend(true,{},y.prototype,{set:function(J,I){var e,H=(arguments.length>1&&I);if(typeof(J)=="string"){e=(J+"").replace(/\%$/,"");this.num=(e=="")?0:this.parseFunc(e);this.txt=this.formatFunc(this.num)+(this.typePercent?"%":"")}else{this.num=J;this.txt=(e=this.formatFunc(J))+(this.typePercent?"%":"")}this.jqo.val(H?e:this.txt);return this}});var k=function(K,I){var L=this,e=(this.jqo=K);this.onChange=I;e.change(function(){L.set().onChange()});o('<option value="">-</option>').appendTo(e);var J=o('meta[name="ogame-planet-coordinates"]').attr("content").replace(/[^0-9\:]/g,"");var H=o('meta[name="ogame-planet-type"]').attr("content").toLowerCase().trim();o.each(o("#planetList").children("div").get(),function(M,N){var O=o(N),P=O.find(".planet-koords");if(P.get().length==0){return}P=P.text().replace(/[^0-9\:]/g,"");option=o('<option value="planet:'+P+'">['+P+"] "+O.find(".planet-name").text().trim()+"</option>").appendTo(e);if(P==J&&H=="planet"){option.addClass(C+"highlight").html(option.html()+" &laquo; "+q.CUR_PLA)}if(O.find(".moonlink").get().length>0){option=o('<option value="moon:'+P+'">['+P+"] ("+q.MOON+")</option>").appendTo(e).addClass(C+"moon");if(P==J&&H=="moon"){option.addClass(C+"highlight").html(option.html()+" &laquo; "+q.CUR_PLA)}}})};k.prototype={use:false,type:0,galaxy:0,system:0,planet:0,set:function(e){var H=((arguments.length>0)?e:this.jqo.val()).split(":");if(H.length<4){this.use=false}else{this.use=true;this.type=H.shift();this.galaxy=H.shift();this.system=H.shift();this.planet=H.shift()}return this}};var z=function(J,M,K){var H,e,L=this,I;if(arguments.length<4){this.isNew=false;this.name=("name" in K)?K.name:(K.id=="MAX")?q.MAX:(K.id=="MIN")?q.MIN:q.REG;this.id=K.id;I=K.ratio}else{this.isNew=true;this.name="*"+q.NEW;I=E.getRatioById(K.defRatio,K).ratio}this.list=J;if(this.isLimit=/^MIN|MAX$/.test(this.id)){this.jqo=o(f.RATIO_LIST_LIMIT).appendTo(J.jqo);this.jqo.find("."+C+"name_noedit").text(this.name)}else{this.jqo=o(this.isNew?f.RATIO_LIST_NEW:f.RATIO_LIST_ITEM).appendTo(J.jqo);this.nameInput=this.jqo.find("."+C+"edit_ratio_name");this.nameInput.change(function(){L.name=L.nameInput.val().trim()}).keyup(function(){L.nameInput.change()}).val(this.name)}this.posLabel=this.jqo.find("."+C+"pos");this.setPos(M);e=["met","cry","deu"];for(H in e){this[e[H]+"Input"]=new l(this.jqo.find("."+C+"edit_ratio_"+e[H]),I[H],"f",true,false,function(){L.list.onChange()})}this.addButton=this.jqo.find("."+C+"icon_add").click(function(){var O=L.list,N=new z(O,L.pos,L.getInfo());N.disableDown().jqo.after(L.jqo);O.list[L.pos]=N;O.list[L.pos-1].enableDown();L.nameInput.val(L.name="*"+q.NEW);L.setPos(++L.pos)});this.upButton=this.jqo.find("."+C+"icon_up").click(function(){L.move(true)});this.upDisabled=false;this.downButton=this.jqo.find("."+C+"icon_down").click(function(){L.move(false)});this.downDisabled=false;this.trashButton=this.jqo.find("."+C+"icon_trash");if(this.isLimit){this.trashButton.addClass("disabled")}else{this.trashButton.click(function(){L.remove()})}this.radio=this.jqo.find('input[name="'+C+'def_ratio"]').click(function(){L.list.defRatio=L.id});if(J.defRatio==this.id){this.radio.click()}this.legal=this.jqo.find("."+C+"legal")};z.prototype={getInfo:function(){var H=this,e={id:H.isNew?v():H.id,ratio:[H.metInput.num,H.cryInput.num,H.deuInput.num]};if(!H.isLimit){e.name=H.name}return e},move:function(H){var I,e;if(H){if(this.upDisabled){return this}I=this.list.list[this.pos-1];this.jqo.after(I.jqo)}else{if(this.downDisabled){return this}I=this.list.list[this.pos+1];I.jqo.after(this.jqo)}e=this.pos;this.setPos(I.pos);I.setPos(e);e=I.upDisabled;if(this.upDisabled){I.disableUp()}else{I.enableUp()}if(e){this.disableUp()}else{this.enableUp()}e=I.downDisabled;if(this.downDisabled){I.disableDown()}else{I.enableDown()}if(e){this.disableDown()}else{this.enableDown()}this.list.sortList()},remove:function(){var I,e=[],J=this.list.list,H=this.list.newItem;this.jqo.remove();J.splice(this.pos,1);for(I=0;I<J.length;I++){e[I]=(J[I].setPos(I))}this.list.list=e;if(this.list.defRatio==this.id){e[0].radio.click()}if(this.downDisabled){e[e.length-1].disableDown()}if(this.upDisabled){e[0].disableUp()}H.setPos(H.pos-1)},enableUp:function(){this.upDisabled=false;this.upButton.removeClass("disabled");return this},enableDown:function(){this.downDisabled=false;this.downButton.removeClass("disabled");return this},disableUp:function(){this.upDisabled=true;this.upButton.addClass("disabled");return this},disableDown:function(){this.downDisabled=true;this.downButton.addClass("disabled");return this},setLegal:function(e){if(e){this.legal.text(q.YES).addClass("undermark").removeClass("overmark")}else{this.legal.text(q.NO).addClass("overmark").removeClass("undermark")}return this},setPos:function(e){if(e%2==0){this.jqo.addClass("alt")}else{this.jqo.removeClass("alt")}this.pos=e;this.posLabel.html(this.isNew?"+":e+1);return this}};var j={list:[],limits:[],clear:function(){for(var H in this.list){this.list[H].jqo.remove()}this.list=(this.limits=[]);try{this.newItem.jqo.remove()}catch(I){}},sortList:function(){this.list.sort(function(H,e){return H.pos-e.pos})},build:function(H){var J,K,I=(arguments.length>0)?H:E.data;this.clear();this.defRatio=I.defRatio;for(J=0;J<I.ratioList.length;J++){K=new z(this,J,I.ratioList[J]);this.list[J]=K;if(K.isLimit){this.limits[this.limits.length]=K}}var e=this.list.length;this.newItem=new z(this,e,I,true);this.list[0].disableUp();this.list[e-1].disableDown();this.onChange()},updateData:function(e){var I=(arguments.length>0)?e:E.data;I.ratioList=[];for(var H in this.list){I.ratioList[H]=this.list[H].getInfo()}I.defRatio=this.defRatio},onChangeItem:function(e){if(!e.isLimit){e.setLegal(u.isLegal(e.getInfo().ratio))}},onChange:function(){u.setLimits(this.limits[0].getInfo().ratio,this.limits[1].getInfo().ratio);for(var e=0;e<this.list.length;e++){this.onChangeItem(this.list[e])}this.onChangeItem(this.newItem)},init:function(e){this.jqo=e;this.build()}};var g=function(H,L,I,e,K){var J=this;this.list=H;this.iface=K;this.pos=L;this.title=I.click(function(){J._click()});this.box=e;if(e.hasClass(C+"hidden")){this.setOpen(false)}else{this.setOpen(true)}};g.prototype={updateOpenCss:function(){this.openCss={height:this.box.height()+"px","padding-top":this.box.css("padding-top"),"padding-bottom":this.box.css("padding-bottom"),"margin-top":this.box.css("margin-top"),"margin-bottom":this.box.css("margin-bottom")};return this},closeCss:{height:0,"padding-top":0,"padding-bottom":0,"margin-top":0,"margin-bottom":0},afterOpenCss:{height:"auto"},duration:250,setOpen:function(e){if(this.isOpen=e){this.list.itemOpen=this}return this},open:function(){this.updateOpenCss().box.removeClass(C+"hidden");return this.setOpen(true)},close:function(){this.updateOpenCss().box.addClass(C+"hidden");return this.setOpen(false)},animateOpen:function(){var e=this.afterOpenCss;this.updateOpenCss().box.css(this.closeCss).removeClass(C+"hidden").animate(this.openCss,this.duration,function(){o(this).css(e)});return this.setOpen(true)},animateClose:function(){var e=this;this.updateOpenCss().box.css(this.openCss).animate(this.closeCss,this.duration,function(){o(this).addClass(C+"hidden").css(e.openCss).css(e.afterOpenCss)});return this.setOpen(false)},_click:function(){if(!this.isOpen){this.iface.clearExport();this.list.itemOpen.animateClose();this.animateOpen()}}};var B={init:function(I,J){this.jqo=I;var H,e=[];I.find("."+C+"config_title").each(function(K,L){e[K]={title:o(L)}});I.find("."+C+"config_box").each(function(K,L){e[K].box=o(L)});this.list=[];for(H=0;H<e.length;H++){this.list[H]=new g(this,H,e[H].title,e[H].box,J)}}};var i=({addCss:function(I){var H=G.createElement("style");H.setAttribute("type","text/css");if(H.styleSheet){H.styleSheet.cssText=I}else{H.appendChild(G.createTextNode(I))}var e=G.getElementsByTagName("head")[0];e.appendChild(H);return this},menuButton:null,menuButtonAction:function(){this.menuButtonAction=function(){};this.makeWindow()},makeMenuButton:function(){var e=this;this.menuButton=o(f.MENUBUTTON).appendTo(o("#menuTableTools")).find("#"+C+"menubutton").click(function(){e.menuButtonAction()});return this},window:null,ogameHide:null,isHidden:true,show:function(){this.isHidden=false;this.ogameHide.hide();this.window.show();return this},hide:function(){this.isHidden=true;this.window.hide();this.ogameHide.show();return this},toggle:function(){if(this.isHidden){return this.show()}return this.hide()},makePlanetSelect:function(){var e=this;this.planet=new k(this.window.find("#"+C+"planet"),function(){e.onChange()});return this},makeActionSelect:function(){var e=this;this.actionJqo=this.window.find("#"+C+"action").change(function(){e.action=o(this).val();e.onChange()}).val(this.action=E.data.defAction);return this},makeResourceInput:function(e,H){var I=this;I["input"+e.capitalize()]=new l(this.window.find("#"+C+"input_"+e),H,"i",false,true,function(){I.checkOutputSelect().onChange()});return this},makeRatioSelect:function(){var e=this;this.ratioSelectJqo=this.window.find("#"+C+"ratio").change(function(){var H=o(this).val().split(":");if(H.length>3){o(this).val("");e.ratioMet.set(parseFloat(H[1]));e.ratioCry.set(parseFloat(H[2]));e.ratioDeu.set(parseFloat(H[3]));e.checkRatio().onChange()}});return this.updateRatioSelect()},updateRatioSelect:function(){var H,e=this.ratioSelectJqo.html("").append(o('<option value="">-</option>'));for(H in E.data.ratioList){ratio=E.getRatio(H);e.append(o('<option value="'+ratio.val+'">'+t.formatF(ratio.met)+":"+t.formatF(ratio.cry)+":"+t.formatF(ratio.deu)+" ("+ratio.name+")</option>"))}return this},makeRatioInput:function(e,H){var I=this;I["ratio"+e.capitalize()]=new l(this.window.find("#"+C+"ratio_"+e),H,"f",true,false,function(){I.checkRatio().onChange()});return this},checkRatio:function(){if(w.isLegal(this.ratioMet.num,this.ratioCry.num,this.ratioDeu.num)){this.ratioIllegal.hide()}else{this.ratioIllegal.show()}return this},makePercentInput:function(e){var I=this,H="percent"+e.capitalize();I[H]=new l(this.window.find("#"+C+"percent_"+e),0,"p",false,true,function(L){if(L.num>100){L.set(100,true)}var J="percentMet",K;if(/Met|Cry/.test(H)&&(!I.percentDeu.isDisabled())){J="percentDeu"}else{if(/Met|Deu/.test(H)&&(!I.percentCry.isDisabled())){J="percentCry"}}K=parseFloat((100-L.num).toFixed((L.num+"").split(".").pop().length));I[J].set(K);I.onChange()});return this},checkOutputSelect:function(){var L=this.outputJqo.val(),J=(this.inputMet.num>0),H=(this.inputCry.num>0),M=(this.inputDeu.num>0),K=/m/.test(L),I=/c/.test(L),e=/d/.test(L);if(!J&&!H&&M&&!K&&!I&&e){this.changeOutputSelect("mc")}else{if(!J&&H&&!M&&!K&&I&&!e){this.changeOutputSelect("md")}else{if(J&&!H&&!M&&K&&!I&&!e){this.changeOutputSelect("cd")}else{if((!J&&H&&M)||K&&((H&&I)||(M&&e))){this.changeOutputSelect("m")}else{if((J&&!H&&M)||I&&((J&&K)||(M&&e))){this.changeOutputSelect("c")}else{if((J&&H&&!M)||e&&((J&&K)||(H&&I))){this.changeOutputSelect("d")}}}}}}return this},changeOutputSelect:function(e){this.outputJqo.val(e);m=this.percentMet.disable().set(0),c=this.percentCry.disable().set(0),d=this.percentDeu.disable().set(0);if(e=="m"){m.set(100)}else{if(e=="c"){c.set(100)}else{if(e=="d"){d.set(100)}else{if(e=="mc"){m.enable().set(50);c.enable().set(50)}else{if(e=="md"){m.enable().set(50);d.enable().set(50)}else{c.enable().set(50);d.enable().set(50)}}}}}return this},makeOutputSelect:function(){var e=this;this.outputJqo=this.window.find("#"+C+"output").change(function(){e.changeOutputSelect(o(this).val());e.onChange()});return this},toggleConfigCalc:function(){var e=this;e.window.toggleClass("config").toggleClass("calc");if(e.configNeverOpen){e.configNeverOpen=false;e.makeImportExport();B.init(e.window.find("#"+C+"config"),e)}return this},updateConfigIface:function(e){var H=(arguments.length>0)?e:E.data;u.setLimits(H);j.build(H);this.ieInput.val("");return this},updateCalcIface:function(){w.setLimits();this.updateRatioSelect().checkRatio();return this},updateConfigData:function(e){var H=(arguments.length>0)?(e):E.data;j.updateData(e);return this},makeConfigButtons:function(){var H=this,e=H.window;e.find("#"+C+"config_but").click(function(){H.toggleConfigCalc()});e.find("#"+C+"config_accept").click(function(){H.updateConfigData();E.save();H.updateCalcIface();H.toggleConfigCalc()});e.find("#"+C+"config_cancel").click(function(){H.updateConfigIface();H.toggleConfigCalc()});e.find("#"+C+"config_default").click(function(){E.remove();H.updateCalcIface();H.updateConfigIface();H.toggleConfigCalc()});return this},makeImportExport:function(){var e=this;this.ieInput=this.window.find("#"+C+"ie_conf").focus(function(){o(this).select()});this.window.find("#"+C+"ie_import").click(function(){try{var H=E.parseData(e.ieInput.val());e.updateConfigIface(H)}catch(I){alert(I)}});this.window.find("#"+C+"ie_export").click(function(){var H=o.extend({},E.data);e.updateConfigData(H);e.ieInput.val("").val(JSON.stringify(H)).select()});return this},clearExport:function(){this.ieInput.val("");return this},makeWindow:function(){E.load();w=new F();u=new F();var I=this,e,H=E.getRatioById(E.data.defRatio);this.ogameHide=o("#inhalt").after(e=(this.window=o(f.WINDOW).hide()));this.addCss(f.CSS).show();this.ratioIllegal=e.find("#"+C+"ratio_illegal").hide();this.outputMessage=e.find("#"+C+"message").click(function(){o(this).select()});this.outputMet=e.find("#"+C+"output_met").text(0);this.outputCry=e.find("#"+C+"output_cry").text(0);this.outputDeu=e.find("#"+C+"output_deu").text(0);e.find("#"+C+"close").click(function(){I.hide()});this.makeActionSelect().makeResourceInput("met",0).makeResourceInput("cry",0).makeResourceInput("deu",0).makeRatioSelect().makeRatioInput("met",H.met).makeRatioInput("cry",H.cry).makeRatioInput("deu",H.deu).makeOutputSelect().makePercentInput("met").makePercentInput("cry").makePercentInput("deu").changeOutputSelect(E.data.defOutput).makePlanetSelect().checkRatio();this.menuButtonAction=function(){I.toggle()};j.init(e.find("#"+C+"ratio_list"),this);this.configNeverOpen=true;this.makeConfigButtons();return this},onChange:function(){var e=b(this.inputMet.num,this.inputCry.num,this.inputDeu.num,this.ratioMet.num,this.ratioCry.num,this.ratioDeu.num,this.percentMet.num,this.percentCry.num,this.percentDeu.num);this.outputMet.text(t.formatI(e.met));this.outputCry.text(t.formatI(e.cry));this.outputDeu.text(t.formatI(e.deu));this.outputMessage.text(A.make(this.action,{met:this.inputMet.txt,cry:this.inputCry.txt,deu:this.inputDeu.txt,},{met:this.outputMet.text(),cry:this.outputCry.text(),deu:this.outputDeu.text(),},{met:this.ratioMet.txt,cry:this.ratioCry.txt,deu:this.ratioDeu.txt,},this.planet));return this},init:function(){return this.makeMenuButton()}}).init()})();